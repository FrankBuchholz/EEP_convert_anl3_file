<!DOCTYPE html>
<html lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META http-equiv="Content-Script-Type" content="text/javascript">
<title>Inventar zu einer EEP-Anlage-Datei (.anl3) anzeigen</title>
<meta name="description" content="Dieses Programm nutzt die Javascript-Funktion DOMParser um eine .anl3-Datei von EEP, die aus XML aufgebaut ist, zu interpretieren und in das Document Object Model (DOM) umzuwandeln. Anschließend wird der Inhalt ausgegeben.">
<meta name="author" content="Frank Buchholz">
<meta name="keywords" content="EEP,.anl3,Inventar" />
<meta name="language" content="de" />
<link rel="icon" href="https://www.eepforum.de/images/favicon.ico" type="image/x-icon">

<script type="text/javascript" src="js/EEP_Texts.js"></script> <!-- Load texts and translations -->
<link rel="stylesheet" href="css/EEP_Texts.css">

<!--
Table Filter Library
https://www.tablefilter.com/

Filter Operators
https://github.com/koalyptus/TableFilter/wiki/4.-Filter-operators

Data types, column operations
https://www.tablefilter.com/data-types.html
-->
<!-- <script src="https://www.tablefilter.com/tablefilter/tablefilter.js"></script> -->
<script src="node_modules/tablefilter/dist/tablefilter/tablefilter.js"></script>
<!-- It's not neccessary to load the style sheet here because it's loaded automatically -->
<!-- <link href="https://www.tablefilter.com/tablefilter/style/tablefilter.css" rel="stylesheet"> -->
<!-- <link href="node_modules/tablefilter/dist/tablefilter/style/tablefilter.css" rel="stylesheet"> -->
<style> /* mod tablefilter */
/* no select/copy to clipboard. Firefox prevents selection even in case of Ctrl-A, but with Chrome it's not relilaby. */
.rdiv,
.fltrow {
	user-select: none; /* no select/copy to clipboard (but it does not work with Ctrl+A) */
}
</style>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<script type="text/javascript"> // Load file
"use strict";
function loadFile(file) {
	let fr;	// upvalue for function processFile
	if (typeof window.FileReader !== 'function') {
		e(null, "p", EEP_Texts.getText("err", "001")); // "The file API isn't supported on this browser yet."
		return;
	};

	if (!file) {
		e(null, "p", EEP_Texts.getText("err", "002")); //"Please select a file before clicking 'Load'"
	} else {
		fr = { FileReader: new FileReader() }; // strict mode does not allow to unset read-only property 'result' directly, therfore we have to put the FileReader into an object
		fr.FileReader.onload = processFile;
		fr.FileReader.readAsText(file);
	}

	// process file (local function to get access to local variable fr)
	function processFile() {

		// Create parser
		const parser = new DOMParser();
		// Parse xml into DOM
		const xmlDoc = parser.parseFromString(fr.FileReader.result, "text/xml");
		//fr.FileReader.result = null; 	// we do not need the file content anymore, but in strict mode we cannot unset the property directly
		delete fr.FileReader;			// however, we can remove the whole thing (see http://perfectionkills.com/understanding-delete/ )

		// Hide fileselector
		document.getElementById('fileselector').classList.add('hidden');

		// Show main area
		document.getElementById('container').classList.remove('hidden');

		// Show file name
		document.getElementById('filename').textContent = file.name.substring(0, file.name.length -1 -1 -3);

		// Process root node (documentElement always represents the root node)
		process_node(xmlDoc.documentElement);
	}

}
</script>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

<script type="text/javascript" src="js/EEP_Signale_Daten.js"></script> <!-- Lade Zusatzdaten zu Signalen: Name, Signalstellungen -->

<script type="text/javascript"> // process_node
"use strict";
function process_node(sutrackp) {
//console.log(sutrackp.nodeName);

	// EEP: Static texts
	const TrackSystemTexts = { 			// per TrackSystemNumber 1-6 (caution: GleissystemID could show other numbers, too) 
		1 : _('Eisenbahn'),
		2 : _('Strassenbahn'),
		3 : _('Strasse'),
		4 : _('Wasserwege'),
		5 : _('Steuerstrecken'),			// nicht in EEP 9
		6 : _('GBS'),						// nicht in EEP 9
	};
	
	function TrackSystemText(GleissystemID) {
		return TrackSystemTexts[TrackSystem[GleissystemID]];
	}

	const GebaeudesammlungText = { 		// GebaeudesammlungID
		1 : _('Eisenbahn'),
		2 : _('Strassenbahn'),
		3 : _('Gleisobjekte Straßen'),
		4 : _('Immobilien'),
		5 : _('Landschaftselemente'),
		6 : _('Sonstiges'),			//  (Wasserwege)
	};

	const Gleisart = { 					// clsid
		"2E25C8E2-ADCD-469A-942E-7484556FF932" : _('Normal'),
		"C889EADB-63B5-44A2-AAB9-457424CFF15F" : _('Weiche'),
		"B0818DD8-5DFD-409F-8022-993FD3C90759" : _('3-Weg-Weiche'),
		"06D80C90-4E4B-469B-BFE0-509A573EBC99" : _('Prellbock'),
	};

	/* Gleisstile:
	http://up.picr.de/33875489iu.pdf
	http://bahn.hersacher.de/splinekatalog/spkat_intro.htm
	*/
	const unsichtbar = [			// unsichtbare Gleisstile
		17, 						// Wasser, Steuerstrecke
		28, 34, 562, 1346, 5100,	// Gleis
		35, 						// Strassenbahn
		36, 						// Strasse
		5145, 5146, 5147,			// Farm track
		5602,						// Fence
		100000,						// Kamerafahrweg
	];

	// GleisData
	const GleisDataText = {
		1	: _('Oberleitung'),											// 1
		2	: _('Weichenlaterne verstecken'),							// 2
		3	: _('Oberleitung') + ', ' + _('Weichenlaterne verstecken'),	// 1 + 2 
		4	: _('Weichenlaterne rechts'),								// 4
		5	: _('Oberleitung') + ', ' + _('Weichenlaterne rechts'),		// 1 + 4
		8	: _('Weichenlaterne links'),								// 8
		9	: _('Oberleitung') + ', ' + _('Weichenlaterne links'),		// 1 + 8
		16	: _('Weichenlaterne als Immobilie/Straßen-T-Kreuzung'),		// special
		18	: _('Doppelkreuzungsweiche'),								// special
		19	: _('Oberleitung') + ', ' + _('Doppelkreuzungsweiche'),		// 1 + special
		20	: _('Straßen-T-Kreuzung'),									// special
//		65	: _('special'),												// 1 +     64 ?
//		69	: _('special'),												// 1 + 4 + 64 ?
//		73	: _('special'),												// 1 + 8 + 64 ?
	};

	// Weichenstellung
	const WeichenstellungText = {
		1 : _('Durchfahrt'),
		2 : _('Abzweig'),
		3 : _('KoAbzweig'),
		5 : _('Spezial'),
	};

	// Groesse der Anlage (alle Positionsangaben in m statt cm)
	const Schandlaft 	= sutrackp.getElementsByTagName('Schandlaft')[0];
	const Area = {
		min : {
			x : Schandlaft.getAttribute('posX') / 100,
			y : Schandlaft.getAttribute('posY') / 100,
		},
		width  	: Math.abs(Schandlaft.getAttribute('posX') * 2 / 100),
		height 	: Math.abs(Schandlaft.getAttribute('posY') * 2 / 100),
	};

	// Verwendeter Bereich der Anlage
	const usedArea = {
		min : {x : 0, y : 0, z : 0},
		max : {x : 0, y : 0, z : 0},
	};

	// Variable für die Ausgabe
	let div;
	div = e(null, 'div' );
	div.classList.add('Intro');

	let EEPversion;
	const Version = sutrackp.getElementsByTagName('Version')[0];
	// EEP Version = 15, Anzahl Objekte = 733, Breite = 1007 m, Tiefe = 607 m
	if (Version) {
		EEPversion = Version.getAttribute('EEP');

		e(div, 'p',
			  `${_('EEP-Version')} = ${Version.getAttribute('EEP')}, `
			+ `${_('Anzahl Objekte')} = ${Version.getAttribute('No3DMs')}, `
			+ `${_('Breite')} = ${Area.width.toFixed(0)} m, `
			+ `${_('Tiefe')} = ${Area.height.toFixed(0)} m`
		);
	}

	// Maps for direct access
	const GleisMap = new Map();	// Verwendung: Gleis = GleisMap.get(GleissystemID).get(GleisID))
	const KollektorMap = new Map();	// Verwendung: Kollektor = KollektorMap.get(KollektorID)

	// Signale und Weichen als Kontaktziele
	const KontaktZiele		= {};

	// Start-Signale zu Ende-Signalen 
	const EndRouteSignals	= {};

	// Sortable arrays
	const
		Weichen 	= [], 	// ID (der Weiche), Gleissystem, Gleis
		Signale 	= [], 	// ID (des Signals), Gleissystem, Gleis, Name, Meldung
		Kontakte 	= [], 	// SetType, Gleissystem, Gleis, Kontakt
		virtualConnections = [], // Gleissystem, Gleis1, Anschluss1, Gleis2, Anschluss
		waitingTrains = [], // ID (des Zugverbandes), speed
		Zugverbaende = new Map(),//[], 	// ID (des Zugverbandes), Name, Gleisort, Fahrzeuge
		Rollmaterialien = [], 	// Name (des Rollmaterials), Rollmaterial, Zugverband
		Gleisstile	 = [],	// Gleisstil, Datei, Anzahl
		Gleisobjekte = [],	// ID, [{GleissystemID, GleisID}], ImmoIdx, gsbname
		Routen		= [],
		Sounds		= [],
		Depots		= [],	// ID,  [{TTrainId, TRouteId, TSpeed, TTime, TDir}]
		Kameras		= [],	// KameraID, Name, Kamera
		GBS_table  	= [];   // Gleisbildstellpulte

	const KameraNamen = {};	// Verwendung: Name = KameraNamen[index];

	const TrackSystem = {};	// Relationship between GleissystemID and TrackSystemNumber

	// Extract data from Gleissystem
	for (const Gleissystem of sutrackp.getElementsByTagName('Gleissystem')) {
		// Use both attributes GleissystemID and TrackSystemNumber if available
		let GleissystemID     = Gleissystem.getAttribute('GleissystemID');
		let TrackSystemNumber = Gleissystem.getAttribute('TrackSystemNumber');
		if (GleissystemID && !TrackSystemNumber) {
			TrackSystemNumber = GleissystemID;
		} else if (!GleissystemID && TrackSystemNumber) {
			GleissystemID = TrackSystemNumber;
		}
		
		// Store relationship between GleissystemID and TrackSystemNumber 
		if (!TrackSystem[GleissystemID]) {
			TrackSystem[GleissystemID] = TrackSystemNumber;
		}

		GleisMap.set(GleissystemID, new Map());

		for (const Gleis of Gleissystem.getElementsByTagName('Gleis')) {

/* Beispiel bis Version EEP 15:
<Gleis GleisID="1" clsid="2E25C8E2-ADCD-469A-942E-7484556FF932" data="0" scale="1" ElectSideS="0" ElectSideE="0" stil="1353" gsbname="\Gleisstile\Gleise\Beton2_Sch_C_LW1.3dm" LockEd="0">
	<Dreibein>
		<Vektor x="-12359.88" y="-1854.389" z="30">Pos</Vektor>
		<Vektor x="0.699066" y="-0.715057" z="0">Dir</Vektor>
		<Vektor x="0.715057" y="0.699066" z="0">Nor</Vektor>
		<Vektor x="-0" y="0" z="1">Bin</Vektor>
	</Dreibein>
	<Anfangsfuehrungsverdrehung Wert="0"/>
	<Charakteristik Kruemmung="0" Torsion="0" Fuehrungsverdrehung="-0" Kurve="0" Laenge="2580"/>
</Gleis>

Beispiel ab Version EEP 16:
https://www.trendverlag.com/Schema/EEP.xsd
https://www.trendverlag.com/Schema/Common.xsd
https://www.trendverlag.com/Schema/traxML.xsd
https://www.trendverlag.com/Schema/Train.xsd

<Gleis GleisID="314" clsid="2E25C8E2-ADCD-469A-942E-7484556FF932" data="0" scale="0.6" ElectSideS="0" ElectSideE="0" OneWay="1" stil="2263" gsbname="\Gleisstile\Strassen\Asphaltstrasse_01_RE1.3dm" LockEd="0">
	<Frame>...</Frame>
	<Interval near="0" far="20.34561"/>

gefolgt von einer der Varianten:

	<Curve>
		<EEPCurve Kruemmung="0" Torsion="0" Fuehrungsverdrehung="-0" Laenge="1768" Kurve="0" Anfangsfuehrungsverdrehung="0">
			<Frame>...</Frame>
		</EEPCurve>
	</Curve>

	<Curve>
		<Line>
			<VectorBundle>
				<Position x="0" y="0" z="0"/>
				<Vector dx="1" dy="0" dz="0"/>
			</VectorBundle>
			<Vector dx="0" dy="0" dz="1"/>
		</Line>
	</Curve>

	<Curve>
		<Arc>
			<VectorBundle2>
				<Position x="0" y="16.40503" z="0"/>
				<Vector dx="1" dy="0" dz="0"/>
				<Vector dx="0" dy="16.40503" dz="0"/>
			</VectorBundle2>
		</Arc>
	</Curve>

	<Curve>
		<Helix a="100.4987" b="2.017408">
			<VectorBundle2>
				<Position x="0" y="0" z="0"/>
				<Vector dx="1" dy="0" dz="0"/>
				<Vector dx="0" dy="1" dz="0"/>
			</VectorBundle2>
		</Helix>
	</Curve>

	<Curve>
		<Rotator a="7.933316E-02" b="-0"/>
	</Curve>

und abgeschlossen mit

	<Twist>...</Twist>
</Gleis>

mit

<Frame>
	<Position x="268582" y="-155050" z="29.99999"/>
	<Vector dx="1" dy="0" dz="0"/>
	<Vector dx="0" dy="1" dz="0"/>
	<Vector dx="0" dy="0" dz="1"/>
</Frame>

*/
			const GleisID = Gleis.getAttribute('GleisID');
			GleisMap.get(GleissystemID).set(GleisID, Gleis);

			let Laenge;

			if (EEPversion && EEPversion >= 16) { /* EEP 16 */

				const Frame		= Gleis.getElementsByTagName("Frame")[0];
				const FramePos	= Frame.getElementsByTagName("Position")[0];
				const Interval 	= Gleis.getElementsByTagName("Interval")[0];
				const near 		= +Interval.getAttribute("near");
				const far 		= +Interval.getAttribute("far");

				Laenge	= Math.abs( far - near );

				Gleis.PosX		= +FramePos.getAttribute("x");
				Gleis.PosY		= +FramePos.getAttribute("y");
				Gleis.PosZ		= +FramePos.getAttribute("z");

				// Identify CurveType
				const Curve 	= Gleis.getElementsByTagName("Curve")[0];
				const EEPCurve  = Curve.getElementsByTagName("EEPCurve")[0];
				const Line		= Curve.getElementsByTagName("Line")[0];
				const Arc		= Curve.getElementsByTagName("Arc")[0];
				const Helix		= Curve.getElementsByTagName("Helix")[0];
				const Clothoid	= Curve.getElementsByTagName("Clothoid")[0];
				const Cubic		= Curve.getElementsByTagName("Cubic")[0];
				const Rotator	= Curve.getElementsByTagName("Rotator")[0];
				const RotatorChain	= Curve.getElementsByTagName("RotatorChain")[0];
				// Depending on CurveType some adjustments might be required!
				// Let's start with a simple case.
				if (EEPCurve) {	// EEPCurve = Line or Arc

					 // assumption: Gleis.Frame does not contain relevant data
					if (Math.abs(+FramePos.getAttribute("x")) > 1 ) {
						console.log(`EEPCurve ${TrackSystemText(GleissystemID)} ${GleisID} has Frame value`);
					}

					const Frame2	= EEPCurve.getElementsByTagName("Frame")[0];
					const Frame2Pos	= Frame2.getElementsByTagName("Position")[0];

					Gleis.PosX		= +Frame2Pos.getAttribute("x") / 100;
					Gleis.PosY		= +Frame2Pos.getAttribute("y") / 100;
					Gleis.PosZ		= +Frame2Pos.getAttribute("z") / 100;

				} else if (Line) {

					const Position	= Line.getElementsByTagName("VectorBundle")[0].getElementsByTagName("Position")[0];
					
					const PosX2		= +Position.getAttribute("x");		// dX
					const PosY2		= +Position.getAttribute("y");		// dY
					const PosZ2		= +Position.getAttribute("z");		// dZ

					Gleis.PosX		+= PosX2;
					Gleis.PosY		+= PosY2;
					Gleis.PosZ		+= PosZ2;

				} else if (Arc) {

					// relative position of center point of the Arc
					const Pos 	= Arc.getElementsByTagName("VectorBundle2")[0].getElementsByTagName("Position")[0];
					const PosX2 = +Pos.getAttribute("x");
					const PosY2 = +Pos.getAttribute("y");
					const PosZ2 = +Pos.getAttribute("z");
					// The distance of the center point = curve radius is the length of the second vector
					const Nor 	= Arc.getElementsByTagName("VectorBundle2")[0].getElementsByTagName("Vector")[1];
					const MidX2 = +Nor.getAttribute("dx");
					const MidY2 = +Nor.getAttribute("dy");
					const MidZ2 = +Nor.getAttribute("dz");
					// Translate by distance of mid point of circle
					Gleis.PosX		+= PosX2 - MidX2; 
					Gleis.PosY		+= PosY2 - MidY2; 
					Gleis.PosZ		+= PosZ2 - MidZ2;

				} else if (Helix) {

					// ... see more calculations in EEP_Gleisplan.html
				
				} else if (Clothoid) {
				
					// ... see more calculations in EEP_Gleisplan.html

				} else if (Cubic) {
				
					// If Frame.Position = 0 and Cubic.Position <> 0 then treat Cubic.Position as the starting point of the curve
					const PositionA	= Cubic.getElementsByTagName("Position")[0];
					const pX		= +PositionA.getAttribute("x");
					const pY		= +PositionA.getAttribute("y");
					const pZ		= +PositionA.getAttribute("z");
				
					Gleis.PosX		+= pX; 
					Gleis.PosY		+= pY; 
					Gleis.PosZ		+= pZ;
					
				} else if (Rotator) {

					// A Rotator looks like an Arc if we can ignore the z-axis

				} else if (RotatorChain) {

					console.log(`RotatorChain not supported yet: ${TrackSystemText(GleissystemID)} ${GleisID}`);
					continue;

				} else { // curve not supported yet

					console.log(`other curve type not supported yet:  ${TrackSystemText(GleissystemID)} ${GleisID}`);
					continue;
				
				}

			} else {  /* EEP 15 */

				const Charakteristik = Gleis.getElementsByTagName("Charakteristik")[0];
				const Dreibein	= Gleis.getElementsByTagName("Dreibein")[0];
				const FramePos	= Dreibein.getElementsByTagName("Vektor")[0];

				Laenge = +Charakteristik.getAttribute("Laenge") / 100;

				Gleis.PosX		= +FramePos.getAttribute("x") / 100;
				Gleis.PosY		= +FramePos.getAttribute("y") / 100;
				Gleis.PosZ		= +FramePos.getAttribute("z") / 100;

			} /* EEP 15 */

			// Verwendeten Bereich der Anlage anpassen (mit zusätzlichen Platz in der Ebene für die Position der Endpunkte)
			usedArea.min.x = Math.min( usedArea.min.x, Gleis.PosX - Laenge );
			usedArea.min.y = Math.min( usedArea.min.y, Gleis.PosY - Laenge );
			usedArea.min.z = Math.min( usedArea.min.z, Gleis.PosZ );

			usedArea.max.x = Math.max( usedArea.max.x, Gleis.PosX + Laenge );
			usedArea.max.y = Math.max( usedArea.max.y, Gleis.PosY + Laenge );
			usedArea.max.z = Math.max( usedArea.max.z, Gleis.PosZ );

			// Weichen
			const WeicheID	= Gleis.getAttribute('Key_Id');
			if (WeicheID) {  // Ist das Gleis eine Weiche?
				Weichen.push({
					ID				: Number(WeicheID),  // sort field

					GleissystemID 	: GleissystemID,
					GleisID 		: GleisID,
				});
			}

			// Weichen mit KontaktZiel
			const KontaktZielEntry 	= Gleis.getElementsByTagName('KontaktZiel')[0];
			if (KontaktZielEntry) {
				const KontaktZiel 	= KontaktZielEntry.textContent;
				if (KontaktZiel != null && KontaktZiel != 0) {
					const WeicheID = Gleis.getAttribute('Key_Id');
					KontaktZiele[KontaktZiel] = {
						Typ				: _('Weiche'),
						ID				: WeicheID,
						GleissystemID 	: GleissystemID,
						GleisID			: GleisID,
					}
				}
			}


			// Signale
			for (const Meldung of Gleis.getElementsByTagName('Meldung')) {
				// get potential sort fields
				const SignalID	= Meldung.getAttribute('Key_Id');
				const Name		= Meldung.getAttribute('name');
				let countTrains = 0;
				
				// Signale mit wartenden Zügen 
				for (const Wartender of Meldung.getElementsByTagName('Wartender')) {
					countTrains += 1;

					const ZugID 		= Wartender.getAttribute('zugverbandID');
					const targetSpeed 	= +Wartender.getAttribute('sollgeschwindigkeit') * 3600 / 1000; // km/h

					waitingTrains[ZugID] = {
						SignalID		: SignalID,
						targetSpeed		: targetSpeed,
					};					
				}

				Signale.push({
					ID				: Number(SignalID),  // sort fields
					Name			: Name,

					GleissystemID 	: GleissystemID,
					GleisID			: GleisID,

					Meldung 		: Meldung,
					
					countTrains		: countTrains,
				});

				// Signale mit KontaktZiel
				const KontaktZielEntry 	= Meldung.getElementsByTagName('KontaktZiel')[0];
				if (KontaktZielEntry) {
					const KontaktZiel 	= KontaktZielEntry.textContent;
					if (KontaktZiel != null && KontaktZiel != 0) {
						KontaktZiele[KontaktZiel] = {
							Typ 			: _('Signal'),
							ID				: SignalID,
							GleissystemID 	: GleissystemID,
							GleisID			: GleisID,
						}
					}
				}
				
				// Signale für Fahrstraßen: Suche Start-Signale zu Ende-Signalen 
				const Routes		= Meldung.getAttribute('Routes');
				const RouteList	 	= Meldung.getElementsByTagName("Route");
				let RoutesText = '';
				for (const Route of RouteList) {
					const Target 	= Route.getAttribute('Target');
					const Color 	= Route.getAttribute('Color');

					if (!EndRouteSignals[Target]) {
						EndRouteSignals[Target] = []
					}
					EndRouteSignals[Target].push({
							StartSignal : SignalID,
							Color : Color,
					})
				}
				
			}

			// Kontakte
			for (const Kontakt of Gleis.getElementsByTagName('Kontakt')) {
				// get potential sort fields
				const SetType	= Kontakt.getAttribute('SetType');

				Kontakte.push({
					ID				: Number(SetType),  // sort fields

					GleissystemID 	: GleissystemID,
					GleisID			: GleisID,

					Kontakt 		: Kontakt,
					KontaktID		: Kontakte.length,	 // arbitrary identfication
				});
				
				// Ausfahrt Zug-Depot
				if (SetType == 1536) {
					const DepotID	= Kontakt.getAttribute('SetValue');
					
					const Trains = [];
					for (let i = 0; true; i++) {
						const TTrainId 	= Kontakt.getAttribute('TTrainId_'+i);	// Verweis auf Zugverband
						if (!TTrainId) {
							break;
						}
						
						const TRouteId 	= Kontakt.getAttribute('TRouteId_'+i);	// Verweis auf Route
						const TSpeed 	= Kontakt.getAttribute('TSpeed_'+i);	// in km/h
						const TTime 	= Kontakt.getAttribute('TTime_'+i);		// individuelle Abfahrtzeit (Sekunden ab Mitternacht)
						const TDir 		= Kontakt.getAttribute('TDir_'+i);		// 0: Richtung eins, 1: Richtung zwei
					
						Trains.push({
						
							TTrainId 	: TTrainId,
							TRouteId	: TRouteId,
							TSpeed		: TSpeed,
							TTime		: TTime,
							TDir		: TDir,
						})
					}
					
					const Wartender = Kontakt.getAttribute('Wartender');	// Auslass-Auto-Zeit
					const SignalData = Kontakt.getAttribute('SignalData');	// bzw. Auslass-SignalId
					
					Depots.push({ 
						ID				: DepotID,
						Wartender		: Wartender,
						SignalData		: SignalData,
						GleissystemID 	: GleissystemID,
						GleisID			: GleisID,

						Trains			: Trains,
					});
				}
			}

			// Gleisstile
			// <Gleis stil="1353" gsbname="\Gleisstile\Gleise\Beton2_Sch_C_LW1.3dm">
			const StilID 		= Number(Gleis.getAttribute('stil'));
			const File			= Gleis.getAttribute('gsbname');

			if (StilID == 0) { // What should we do if there is no value?
			}

			const index = Gleisstile.findIndex(function (element) {
				return (element.ID == StilID && element.Name == File);
			});
			if (index == -1) {
				Gleisstile.push({
					ID				: StilID,
					Name			: File,
					Anzahl			: 1,
				})
			} else {
				Gleisstile[index].Anzahl = Gleisstile[index].Anzahl + 1;
			}

		}
	
		for (const Gleisverbindung of Gleissystem.getElementsByTagName('Gleisverbindung')) {
			// <Gleisverbindung GleisID1="1" Anschluss1="Anfang" GleisID2="2" Anschluss2="Ende" Flags="1"/>
			const GleisID1   = Gleisverbindung.getAttribute('GleisID1');
			const Anschluss1 = Gleisverbindung.getAttribute('Anschluss1');
			const GleisID2   = Gleisverbindung.getAttribute('GleisID2');
			const Anschluss2 = Gleisverbindung.getAttribute('Anschluss2');
			const Flags      = Gleisverbindung.getAttribute('Flags');

			if (Flags && Flags == 1) { // Virtual connection
				virtualConnections.push({
					//ID				: ID,  // sort fields
					//Name			: Name,

					GleissystemID 	: GleissystemID,
					GleisID1 		: GleisID1,
					Anschluss1 		: Anschluss1,
					GleisID2 		: GleisID2,
					Anschluss2 		: Anschluss2,
				});
			}
		}
	}

	// Verwendeter Bereich der Anlage anpassen (nicht größer als die Anlage selber)
	usedArea.min.x = Math.max( usedArea.min.x, Area.min.x );
	usedArea.min.y = Math.max( usedArea.min.y, Area.min.y );
	usedArea.max.x = Math.min( usedArea.max.x, Area.min.x + Area.width  );
	usedArea.max.y = Math.min( usedArea.max.y, Area.min.y + Area.height );

	// Extract data from GBS
	for (const Gebaeudesammlung of sutrackp.getElementsByTagName('Gebaeudesammlung')) {
		const GebaudesammlungID = Gebaeudesammlung.getAttribute('GebaudesammlungID');
		if ( GebaudesammlungID != 4 ) { continue; }

		for (const Immobile of Gebaeudesammlung.getElementsByTagName('Immobile')) {
			const GBSObjects = Immobile.getElementsByTagName('GBSObject');
			if ( GBSObjects.length == 0 ) { continue; } 

			const gsbname			= Immobile.getAttribute('gsbname');
			const ImmoIdx			= Immobile.getAttribute('ImmoIdx');

			const Dreibein			= Immobile.getElementsByTagName('Dreibein')[0];
			const Vektor			= Dreibein.getElementsByTagName('Vektor')[0];
			const PosX				= +Vektor.getAttribute('x') / 100;
			const PosY				= +Vektor.getAttribute('y') / 100;
			const PosZ				= +Vektor.getAttribute('z') / 100;

			const GBSObject 		= GBSObjects[0]; 
			
			const ID     			= GBSObject.getAttribute('id');
			const Name     			= GBSObject.getAttribute('Name');
			
			const GleissystemID  	= GBSObject.getAttribute('GleissystemID');
			const Width     		= +GBSObject.getAttribute('Width');				// Breite des GBS
			const Height     		= +GBSObject.getAttribute('Height');				// Höhe des GBS
			
			const Tiles = [];
			for (const GBSElement of GBSObject.getElementsByTagName('GBSElement')) {
				const Tile = {};
			
				Tile.x     			= +GBSElement.getAttribute('x');					// Position des GBS-Elements
				Tile.y    			= +GBSElement.getAttribute('y');					// Position des GBS-Elements
				
				Tile.ID				= ( Tile.y - 1 ) * Width + Tile.x;				// ID to sort by position

				Tile.Kammera		= GBSElement.getAttribute('Kammera'); 			// Gleissymbol 36 = Kammera

				// Get track symbols
				const Modell 		= GBSElement.getElementsByTagName('Modell')[0];
				const Table 		= Modell.getElementsByTagName('Table')[0];
				const Count 		= +Table.getAttribute('Count');
				Tile.TrackSymbol	= +Table.getAttribute('e0');						// Codenummer des Gleissymbols
				Tile.Signal_left 	= +Table.getAttribute('e1');						// Codenummer für Signalsymbol Links
				Tile.Signal_mid 	= +Table.getAttribute('e2');						// Codenummer für Signalsymbol Mitte
				Tile.Signal_right 	= +Table.getAttribute('e3');						// Codenummer für Signalsymbol Rechts

				// Get switch ID
				for (const TakeSwitch of GBSElement.getElementsByTagName('TakeSwitch')) { 	// one optional entry
					const Table 	= TakeSwitch.getElementsByTagName('Table')[0];
					const Count 	= +Table.getAttribute('Count');
					Tile.SwitchID 	= +Table.getAttribute('e0');						// Switch ID
				}				

				// Get signal ID
				for (const Signal of GBSElement.getElementsByTagName('Signal')) { 	// one optional entry
					const Table 		= Signal.getElementsByTagName('Table')[0];
					const Count 		= +Table.getAttribute('Count');
					Tile.SignalID_left 	= +Table.getAttribute('e0');					// Signal-ID Links
					Tile.SignalID_mid 	= +Table.getAttribute('e1');					// Signal-ID Mitte
					Tile.SignalID_right = +Table.getAttribute('e2');					// Signal-ID Rechts
				}

				// Get tracks
				Tile.Tracks = [];
				for (let i = 1; i <= 4; i++) {
					const Tracks = GBSElement.getElementsByTagName('Tracks' + i);	// Tracks1 - Tracks4
					if ( Tracks.length == 0 ) { 
						Tile.Tracks.push( 0 );
						continue;
					}
					
					const Table 	= Tracks[0].getElementsByTagName('Table')[0];
					const Count 	= +Table.getAttribute('Count');
					const GleisID	= +Table.getAttribute('e0');						// GleisID für die Besetztmeldung
					Tile.Tracks.push( GleisID );
				}
				
				// Store GBSElement
				Tiles.push( Tile );
			}
			
			// Store GBSObject
			GBS_table.push( {
				ID 				: ID,
				Name			: ( Name ? Name : "GBS_" + ID ),
				
				gsbname			: gsbname,
				ImmoIdx			: ImmoIdx,
				
				PosX			: PosX,
				PosY			: PosY,
				PosZ			: PosZ,
				
				GleissystemID 	: GleissystemID,
				Width 			: Width,
				Height 			: Height,
				Tiles 			: Tiles,
			});		
		}
	}

	// Extract data from Fuhrpark
	const Fuhrpark = sutrackp.getElementsByTagName('Fuhrpark')[0];
	for (const Zugverband of Fuhrpark.getElementsByTagName('Zugverband')) {
		const ZugID		= Zugverband.getAttribute('ZugID');
		const Name		= Zugverband.getAttribute('name');
		const Gleisort	= Zugverband.getElementsByTagName('Gleisort')[0];
		const Fahrzeuge = [];

		const ZugverbandRollmaterial = Zugverband.getElementsByTagName('Rollmaterial');
		let Position = 0;
		for (const Rollmaterial of ZugverbandRollmaterial) {
			Fahrzeuge.push({
				Rollmaterial : Rollmaterial,
			});
			Position += 1;
			Rollmaterialien.push({
				Name		 : Rollmaterial.getAttribute('name'),  // sort field 
				
				Rollmaterial : Rollmaterial,
				Zugverband	 : Zugverband,
				Position 	 : Position,
			});
		}

		Zugverbaende.set(Number(ZugID), {	// Zugverbaende.push({
			ID				: Number(ZugID),  // sort fields
			Name			: Name,

			Zugverband		: Zugverband,
			Gleisort 		: Gleisort,
			Anzahl			: ZugverbandRollmaterial.length,
			Fahrzeuge		: Fahrzeuge,
		});
	}

	// Extract Gleisobjekt data from Kollektor
	for (const Kollektor of sutrackp.getElementsByTagName('Kollektor')) {
		const KollektorID		= Number(Kollektor.getAttribute('id'));

		KollektorMap.set(KollektorID, Kollektor);

		Gleisobjekte.push({
			ID				: KollektorID,  // sort field

			Kollektor 		: Kollektor,
		});

		// Cross reference
		for (const GleisEntry of Kollektor.getElementsByTagName("Gleis")) {
			const GleissystemID = GleisEntry.getAttribute('gleissystemID');
			const GleisID 		= GleisEntry.getAttribute('gleisID');

			const Gleis = GleisMap.get(GleissystemID).get(GleisID);
			Gleis.Kollektor = Kollektor;
		}
	}

	// Extract Gleisobjekt data from Gebaeudesammlung
	for (const Gebaeudesammlung of sutrackp.getElementsByTagName('Gebaeudesammlung')) {
		const GebaudesammlungID	= Gebaeudesammlung.getAttribute('GebaudesammlungID');
		for (const Immobile of Gebaeudesammlung.getElementsByTagName('Immobile')) {
			const ImmoIdx		= Immobile.getAttribute('ImmoIdx');
			const KollektorID 	= Number(Immobile.getAttribute('kollektorID'));
			const gsbname 		= Immobile.getAttribute('gsbname');

			if (KollektorID) {
				const Kollektor = KollektorMap.get(KollektorID);
				if (Kollektor) {
					Kollektor.GebaudesammlungID = GebaudesammlungID;
					Kollektor.Immobile 	= Immobile;
					Kollektor.ImmoIdx 	= ImmoIdx;
					Kollektor.gsbname 	= gsbname;
				}
			}
		}
	}

	// Extract data from Options
	/*
	<Options RouteItems="4" SoundItems="0" RouteId_0="1" RouteName_0="Strecke" RouteId_1="2" RouteName_1="Rangieren" RouteId_2="3" RouteName_2="Tausch" RouteId_3="4" RouteName_3="Weiterfahrt" FavTrainCB="0"/>
	*/
	const Options = sutrackp.getElementsByTagName('Options')[0];
	const RouteItems = +Options.getAttribute('RouteItems');
	for (let i = 0; i < RouteItems; i++) {
		const RouteID	= Options.getAttribute('RouteId_' + i);
		const RouteName = Options.getAttribute('RouteName_' + i);

		Routen[RouteID] = RouteName;
	}
	const SoundItems = +Options.getAttribute('SoundItems');
	for (let i = 0; i < SoundItems; i++) {
		const SoundID	= Options.getAttribute('SndId_' + i);
		const SoundName = Options.getAttribute('SndName_' + i);

		Sounds[SoundID] = SoundName;
	}

	// Extrakt data from Kamerasammlung
	const Kamerasammlung = sutrackp.getElementsByTagName('Kammerasammlung')[0];
	const KameraList = Kamerasammlung.getElementsByTagName('Kammera');
	let KameraID = 0;
	for (const Kamera of KameraList) {
		KameraID += 1;

		const Name 	= Kamera.getAttribute('name');
		/* Ignore not-used cameras
		Should we check the default name or the default position to identify such cameras?
		Some observations:
		- The default name is language dependent, see file eep.lng entry [OTHER]CAMERA_NAME
		- Pos and Dir seem to have quite specific values
		- Dir is not a unit vector
		- Nor and Bin values might vary
		<Kammera name="Leer" DOF="0" Dynamic="0" FocalIdx="193" FStopIdx="13" SubDist="100" DOFSubDist="100" DOFShiftNear="9.65" DOFShiftFar="12.965" FOV="0" TakeSwitch="0">
			<Dreibein>
				<Vektor x="6000" y="-6000" z="400">Pos</Vektor>
				<Vektor x="-6000" y="6000" z="-400">Dir</Vektor>
				<Vektor x="-0.7071068" y="-0.7071068" z="0">Nor</Vektor>
				<Vektor x="-3.329636E-02" y="3.329636E-02" z="0.9988908">Bin</Vektor>
			</Dreibein>
		</Kammera>
		*/
		if (Name === "Leer" || Name === "blank" || Name === "Vide" ) {
			continue;
		}

		Kameras.push({
			ID				: KameraID,  // sort fields
			Name			: Name,

			Kamera 			: Kamera,
		});

		KameraNamen[KameraID] = Name;
	}

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige des verwendeten Bereichs
	e(div, 'p',
		`${_('Verwendeter Bereich')}: (${(usedArea.min.x).toFixed(0)} m, ${(usedArea.min.y).toFixed(0)} m) .. (${(usedArea.max.x).toFixed(0)} m, ${(usedArea.max.y).toFixed(0)} m)`
	);
	e(div, 'p',
		`${_('Min./max Höhe')}: ${(usedArea.min.z).toFixed(0)} m .. ${(usedArea.max.z).toFixed(0) } m`
	);

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->


	// Anzeige der Weichen
	div = createTable({
		id		: 'Weiche',
		title 	: `${_('Weichen')} (${Weichen.length})`,
		caption	: _('Weichen'),
		content	: function(thead, tbody) {

		Weichen.sort(orderByID).forEach(Weiche => {

		const WeicheID		= Weiche.ID;
		const GleissystemID	= Weiche.GleissystemID;
		const GleisID 		= Weiche.GleisID;
		const Gleis 		= GleisMap.get(GleissystemID).get(GleisID);
		const File			= Gleis.getAttribute('gsbname');
		const KontaktZiel 	= Gleis.getElementsByTagName('KontaktZiel')[0].textContent;
		const GleisData		= Gleis.getAttribute('data'); 		// Bitfeld einer Weiche
		const clsid			= Gleis.getAttribute('clsid');
		const weichenstellung = Gleis.getAttribute('weichenstellung');
		const SignalData 	= Gleis.getAttribute('SignalData');
		const NextSigFn1 	= Gleis.getAttribute('NextSigFn1');
		const NextSigFn2 	= Gleis.getAttribute('NextSigFn2');
//		const NextSigFn3 	= Gleis.getAttribute('NextSigFn3');
//		const NextSigFn4 	= Gleis.getAttribute('NextSigFn4');
//		const NextSigFn5 	= Gleis.getAttribute('NextSigFn5');

		const Kollektor		= Gleis.Kollektor;
		const GleisobjektID	= (Kollektor ? Number(Gleis.Kollektor.getAttribute('id')) : false );

		fillTable(thead, tbody, [

		{ th : _('Weiche'),
			td :
				  `<a href="javascript:void(0);" onclick="javascript:postIDMessage(${WeicheID},${GleissystemID},${GleisID});">`
				+ WeicheID
				+ `<\/a>`,
			html : true, },
		{ th : _('Gleis'),
			td :
				  `<a href="javascript:void(0);" onclick="javascript:postGleisMessage(${GleissystemID},${GleisID});">`
				+ TrackSystemText(GleissystemID) + ' ' + GleisID
				+ `<\/a>`,
			html : true, },
		{ th : `x (m)`,				td : Gleis.PosX.toFixed(0) },
		{ th : `y (m)`,				td : Gleis.PosY.toFixed(0) },
		{ th : _('Kontaktziel'),	td : (KontaktZiel != 0 ? KontaktZiel : '') },
		{ th : _('Gleisart'),		td : Gleisart[clsid] },
		{ th : _('Gleisobjekt'),	td :
			(GleisobjektID ? `<a href="#Gleisobjekt_${GleisobjektID}">${GleisobjektID}<\/a>` : '')
			, html : true
			},
		{ th : _('Weichenstellung'),	td : weichenstellung + ': ' + WeichenstellungText[weichenstellung] },
		{ th : _('SignalData'),		td : SignalData },
		{ th : `NextSigFn1`,		td : NextSigFn1 },
		{ th : `NextSigFn2`,		td : NextSigFn2 },
		{ th : _('GleisData'),		td : (GleisData != 0 ? GleisData + ': ' + GleisDataText[GleisData] : '') },
		{ th : _('Datei'),			td : File },

		]) })

		return Weichen.length;
		}
	})

	if (Weichen.length > 0) {
		e(div, 'p', 'SignalData: ' + _('Weiche ist verknüpft mit Signal/Weiche'));
		e(div, 'p', 'NextSigFn1: ' + _('Wenn Weiche auf "Durchfahrt" steht dann verknüpfte ID in angegebene Stellung schalten'));
		e(div, 'p', 'NextSigFn2: ' + _('Wenn Weiche auf "Abzweig" steht dann verknüpfte ID in angegebene Stellung schalten'));
	}

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige der Signale
	/*
	<Meldung Position="1687.619" ParaOderAnti="0" fireOnPara="1" fireOnAnti="0" clsid="D180F669-DCCC-42E9-960C-B5305B29F69D" name="ShSig_Licht_EpIV_kl" Key_Id="34" Hofs="300" Vofs="300" LockEd="0">
		<KontaktZiel>2</KontaktZiel>
		<Signal stellung="2" wirkungsdistanz="1000" StopAt="0" Geschwindigkeit="0" Delay="0" ActDelay="0"/>
			<Wartender fuhrparkID="1" zugverbandID="6" sollgeschwindigkeit="13.88889"/>
		</Signal>	
	</Meldung>

	Achtung: Fahrstrassen werden ebenfalls durch Meldungen realisiert
	Dabei gilt name="system\Route_SignalS.3ds" für den Start bzw. name="system\Route_SignalZ.3ds" für das Ende einer Fahrstrasse.
	*/
	div = createTable({
		id		: 'Signal',
		title 	: `${_('Signale')} (${Signale.length})`,
		caption	: _('Signale'),
		content	: function(thead, tbody) {

		Signale.sort(orderByID).forEach(Signal => {

		const SignalID		= Signal.ID;
		const File			= Signal.Name;
		const GleissystemID	= Signal.GleissystemID;
		const GleisID 		= Signal.GleisID;
		const Gleis 		= GleisMap.get(GleissystemID).get(GleisID);
		const Position		= Signal.Meldung.getAttribute('Position') / 100;
		const Stellung		= Signal.Meldung.getElementsByTagName('Signal')[0].getAttribute('stellung');
		const Count			= Signal.Meldung.getElementsByTagName('Signal')[0].getAttribute('Count');
		const SignalData	= Signal.Meldung.getElementsByTagName('Signal')[0].getAttribute('SignalData');
		const Distanz		= Signal.Meldung.getElementsByTagName('Signal')[0].getAttribute('wirkungsdistanz') / 100;
		const ParaOderAnti 	= Signal.Meldung.getAttribute('ParaOderAnti'); // Gleisrichtung 0: Ende -> Anfang, 1: Anfang -> Ende
		const KontaktZiel 	= Signal.Meldung.getElementsByTagName('KontaktZiel')[0].textContent;
		const TipTxt	 	= Signal.Meldung.getAttribute('TipTxt');
		
		const countTrains	= Signal.countTrains;

		// Fahrstraßen
		const Routes		= Signal.Meldung.getAttribute('Routes');
		const RouteList	 	= Signal.Meldung.getElementsByTagName("Route");

		// Fahrstraßen
		const ColorText = { // <color> modulo 8
			0: { name: _('grau'),	color: 'rgb(180,180,180)', 	},
			1: { name: _('rot'),	color: 'rgb(220,0,0)', 		},
			2: { name: _('grün'),	color: 'rgb(0,220,0)', 		},
			3: { name: _('blau'),	color: 'rgb(0,0,220)', 		},
			4: { name: _('gelb'),	color: 'rgb(220,220,0)', 	},
			5: { name: _('pink'),	color: 'rgb(220,0,220)', 	},
			6: { name: _('hellblau'), color: 'rgb(0,180,220)', 	},
			7: { name: _('orange'),	color: 'rgb(220,110,0)',	},
		}
		let RoutesText = '';
		// Details für Start-Signale
		for (const Route of RouteList) {
			const Target 	= Route.getAttribute('Target');
			const Color 	= Route.getAttribute('Color');

			RoutesText +=
				  _('Zielsignal') + ': ' + Target
				+ ', ' + '<span style="color:' + ColorText[Color%8].color + ';">' + _('Farbe') + ': ' + Color + ' ' + ColorText[Color%8].name + '</span><br>'
				;
		}
		// Details für Ende-Signale
		const EndRouteSignal = EndRouteSignals[SignalID];
		if (EndRouteSignal) {
			for (const Route of EndRouteSignal) {
				RoutesText +=
					  _('Startsignal') + ': ' + Route.StartSignal
					+ ', ' + '<span style="color:' + ColorText[Route.Color%8].color + ';">' + _('Farbe') + ': ' + Route.Color + ' ' + ColorText[Route.Color%8].name + '</span><br>'
					;
			}
		}

		function getSignalName(File) {
			let Name = '';
			if (!Signalstellung[File]) {
				// no name
			} else if (typeof(Signalstellung[File].Name) === "string") {
				Name = Signalstellung[File].Name;
			} else if (typeof(Signalstellung[File].Name) === "object") {
				Name = Signalstellung[File].Name[EEP_Texts.getLanguage()]
					|| Signalstellung[File].Name.DE
					|| Signalstellung[File].Name.EN
					;
			} else {
				// no name
			}
			return Name;
		}
		function getSignalPositionText(File, Position) {
			let Text = '';
			if (!Signalstellung[File]) {
				// no text
			} else if (typeof(Signalstellung[File].Pos[Position]) === "string") {
				Text = Signalstellung[File].Pos[Position];
			} else if (typeof(Signalstellung[File].Pos[Position]) === "object") {
				Text = Signalstellung[File].Pos[Position][EEP_Texts.getLanguage()]
					|| Signalstellung[File].Pos[Position].DE	// primary language
					|| Signalstellung[File].Pos[Position].EN	// secondary language
					;
			} else {
				// no text
			}
			
			// Default translations
			if (Text === "Fahrt") 	{ Text = _("Fahrt") };
			if (Text === "Halt") 	{ Text = _("Halt") };
			
			return Text;
		}
		let SignalstellungText = Stellung;
		let SignalstellungenText = '';
		if (Signalstellung[File]) {
			// 1st try: Get texts (case sensitive file name)
			SignalstellungText += ' : ' + getSignalPositionText(File, Stellung);

			for (const StellungPos in Signalstellung[File].Pos) {
				SignalstellungenText += StellungPos + ' : ' + getSignalPositionText(File, StellungPos) + '<br>';
			}
		} else {
			// 2nd try: Get texts (case insensitive file name)
			for (const SignalFile in Signalstellung) {
				if (SignalFile.toLowerCase() == File.toLowerCase()) {
					SignalstellungText += ' : ' + getSignalPositionText(SignalFile, Stellung);

					for (const StellungPos in Signalstellung[SignalFile].Pos) {
						SignalstellungenText += StellungPos + ' : ' + getSignalPositionText(SignalFile, StellungPos) + '<br>';
					}
				}
			}
		}

		fillTable(thead, tbody, [

		{ th : _('Signal'),
			td :
				  `<a href="javascript:void(0);" onclick="javascript:postIDMessage(${SignalID},${GleissystemID},${GleisID});">`
				+ SignalID
				+ `<\/a>`,
			html : true, },
		{ th : _('Gleis'),
			td :
				  `<a href="javascript:void(0);" onclick="javascript:postGleisMessage(${GleissystemID},${GleisID});">`
				+ TrackSystemText(GleissystemID) + ' ' + GleisID
				+ `<\/a>`,
			html : true, },
		{ th : `x (m)`,					td : Gleis.PosX.toFixed(0), },
		{ th : `y (m)`,					td : Gleis.PosY.toFixed(0), },
		{ th : _('Position') + ' (m)',	td : Position.toFixed(0), },
		{ th : _('Distanz zum Hauptsignal') + ' (m)',	td : (Distanz !=0 ? Distanz.toFixed(0) : ''), },
		{ th : _('Gleisrichtung'),		td : ParaOderAnti, },
		{ th : _('Signalstellung'),		td : SignalstellungText, },
		{ th : _('Anzahl Signalstellungen'),	td : Count, },
		{ th : _('Signalstellungen'), 	td : SignalstellungenText, html : true, },
		{ th : _('SignalData'),			td : SignalData, },
		{ th : _('Kontaktziel'),		td : (KontaktZiel != 0 ? KontaktZiel : ''), },
		{ th : _('Anzahl Fahrstraßen'),	td : Routes, },
		{ th : _('Fahrstraßen'),		td : RoutesText, html : true, },
		{ th : _('Anzahl wartender Zugverbände'), td : countTrains, },
		{ th : _('Datei'),				td : File, },
		{ th : _('Name'),				td : getSignalName(File), },
		{ th : _('TipTxt'),				td : (TipTxt ? TipTxt : '') },

		]) })

		return Signale.length;
		}
	})

	if (Signale.length > 0) {
		e(div, 'p', 'SignalData: ' + _('Signal ist verknüpft mit Signal/Weiche'));
	}

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige der Kontakte
	/*
	<Kontakt Position="712.3505" ParaOderAnti="1" fireOnPara="0" fireOnAnti="1" Teiler="1" ActTeiler="0" TrainSide="1" Route="0" Route2="0" SetType="0" SetValue="0" Delay="0" ActDelay="0" TrainID="0" TrainID2="0" Light="2" LastTrainID="26" LastOfs="742.3113" ConnectF="2" ConnectR="2" VolDist="20" zuStellung="2" Wartender="0" AxisPos="0" AxisFilter="" NameFilter="" TrainNewName="" KontaktDist="0" TrainDist="0" LuaFn="" Group="0" AnimID="0" CheckAuto="2" SetAuto="2" SignalData="0" SigNeg="0" LockEd="0" KontaktZiel="2" Wechseln="0" clsid="5E9A3049-D465-4602-A285-6A9774DCF1BF"/>
	
	Beispiel mit TrainID
	<Kontakt Position="3171.579" ParaOderAnti="1" fireOnPara="0" fireOnAnti="1" Teiler="10" ActTeiler="9" TrainSide="0" Route="0" Route2="0" SetType="512" SetValue="150" Delay="0" ActDelay="0" TrainID="24" TrainID2="0" Light="2" LastTrainID="0" LastOfs="0" ConnectF="1114198" ConnectR="0" VolDist="20" zuStellung="1" Wartender="0" AxisPos="0" AxisFilter="" NameFilter="" TrainNewName="" KontaktDist="0" TrainDist="0" LuaFn="" Group="0" AnimID="0" CheckAuto="2" SetAuto="2" TimeFrom="0" TimeTo="0" SignalData="0" SigNeg="0" LockEd="0" clsid="5E9A3049-D465-4602-A285-6A9774DCF1BF"/>
	
	Beispiel mit TrainID2
	<Kontakt Position="418.1413" ParaOderAnti="1" fireOnPara="0" fireOnAnti="1" Teiler="1" ActTeiler="0" TrainSide="0" Route="0" Route2="0" SetType="5" SetValue="0" Delay="0" ActDelay="0" TrainID="0" TrainID2="7" Light="2" LastTrainID="7" LastOfs="418.1413" ConnectF="2" ConnectR="2" VolDist="650" zuStellung="0" Wartender="0" AxisPos="53" AxisFilter="Ladegeshirr heben/senken" NameFilter="" TrainNewName="" KontaktDist="0" TrainDist="0" LuaFn="" Group="0" AnimID="0" CheckAuto="2" SetAuto="2" TimeFrom="0" TimeTo="0" SignalData="0" SigNeg="0" LockEd="0" clsid="5E9A3049-D465-4602-A285-6A9774DCF1BF"/>	

	*/
	div = createTable({
		id		: 'Kontakt',
		title 	: `${_('Kontakte')} (${Kontakte.length})`,
		caption	: _('Kontakte'),
		content	: function(thead, tbody) {

		Kontakte.sort(orderByID).forEach(Kontakt => {  // no ID, therfore no sort

		const KontaktID		= Kontakt.KontaktID;
		// const SetType 		= Kontakt.ID;
		const SetType 		= Kontakt.Kontakt.getAttribute('SetType');
		const SetValue 		= Kontakt.Kontakt.getAttribute('SetValue');
		const KontaktZiel 	= Kontakt.Kontakt.getAttribute('KontaktZiel');
		const GleissystemID	= Kontakt.GleissystemID;
		const GleisID 		= Kontakt.GleisID;
		const Gleis 		= GleisMap.get(GleissystemID).get(GleisID);
		const Position		= Kontakt.Kontakt.getAttribute('Position') / 100;
		const ParaOderAnti 	= Kontakt.Kontakt.getAttribute('ParaOderAnti'); // Gleisrichtung 0: Ende -> Anfang, 1: Anfang -> Ende
		const fireOnPara 	= Kontakt.Kontakt.getAttribute('fireOnPara');
		const fireOnAnti 	= Kontakt.Kontakt.getAttribute('fireOnAnti');
		const Teiler 		= Kontakt.Kontakt.getAttribute('Teiler');
		const ActTeiler 	= Kontakt.Kontakt.getAttribute('ActTeiler');
		const Delay 		= Kontakt.Kontakt.getAttribute('Delay');
		const ActDelay 		= Kontakt.Kontakt.getAttribute('ActDelay');
		const TrainSide 	= Kontakt.Kontakt.getAttribute('TrainSide');
		const RouteID 		= Kontakt.Kontakt.getAttribute('Route');
		const TrainID 		= Kontakt.Kontakt.getAttribute('TrainID');
		const TrainID2 		= Kontakt.Kontakt.getAttribute('TrainID2');
		const NameFilter 	= Kontakt.Kontakt.getAttribute('NameFilter');
		const TrainNewName 	= Kontakt.Kontakt.getAttribute('TrainNewName');
		const zuStellung 	= Kontakt.Kontakt.getAttribute('zuStellung');
		const Wechseln 		= Kontakt.Kontakt.getAttribute('Wechseln');
		const ConnectF 		= Kontakt.Kontakt.getAttribute('ConnectF');
		const ConnectR 		= Kontakt.Kontakt.getAttribute('ConnectR');
		const VolDist 		= Kontakt.Kontakt.getAttribute('VolDist');
		const SignalData 	= Kontakt.Kontakt.getAttribute('SignalData');
		const AxisPos 		= Kontakt.Kontakt.getAttribute('AxisPos'); 
		const AxisFilter 	= Kontakt.Kontakt.getAttribute('AxisFilter');
		const LuaFn		 	= Kontakt.Kontakt.getAttribute('LuaFn');
		const TipTxt	 	= Kontakt.Kontakt.getAttribute('TipTxt');

		// Achtung: die Variable $1 wird ersetzt
		const KontaktText = {	// SetValue
			0 		: _('Weiche/Signal'),

			8 		: _('Halt $1 m'), // Haltekontakt für befahrbares Rollmaterial
			
		1 		: _('Fahrzeug')+(+SetValue > 0 ? " "+_('Geschwindigkeit')+" "+_('nicht langsamer als $1 km/h') : ""),
		2 		: _('Fahrzeug')+" "+_('Geschwindigkeit')+" "+_('nicht schneller als $1 km/h'),
		3 		: _('Fahrzeug')+" "+_('Geschwindigkeit')+" "+_('festlegen auf $1 km/h'),

		5 		: _('Fahrzeug')+" "+_('Fahrtrichtungsumkehr')+(+SetValue > 0 ? ", "+_('Geschwindigkeit')+" "+_('nicht langsamer als $1 km/h') : ""),
		6 		: _('Fahrzeug')+" "+_('Fahrtrichtungsumkehr')+", "+_('Geschwindigkeit')+" "+_('nicht schneller als $1 km/h'),
		7 		: _('Fahrzeug')+" "+_('Fahrtrichtungsumkehr')+", "+_('Geschwindigkeit')+" "+_('festlegen auf $1 km/h'),
		
		17 		: _('Fahrzeug')+" "+_('Geschwindigkeit')+" "+_('wiederherstellen')+(+SetValue > 0 ? ", "+_('nicht langsamer als $1 km/h') : ""),
		18 		: _('Fahrzeug')+" "+_('Geschwindigkeit')+" "+_('wiederherstellen')+", "+_('nicht schneller als $1 km/h'),
		19 		: _('Fahrzeug')+" "+_('Geschwindigkeit')+" "+_('wiederherstellen')+", "+_('festlegen auf $1 km/h'),

		21 		: _('Fahrzeug')+" "+_('Fahrtrichtungsumkehr')+", "+_('Geschwindigkeit')+" "+_('wiederherstellen')+(+SetValue > 0 ? ", "+_('nicht langsamer als $1 km/h') : ""),
		22 		: _('Fahrzeug')+" "+_('Fahrtrichtungsumkehr')+", "+_('Geschwindigkeit')+" "+_('wiederherstellen')+", "+_('nicht schneller als $1 km/h'),
		23 		: _('Fahrzeug')+" "+_('Fahrtrichtungsumkehr')+", "+_('Geschwindigkeit')+" "+_('wiederherstellen')+", "+_('festlegen auf $1 km/h'),
		
		33 		: _('Fahrzeug')+" "+_('Geschwindigkeit')+" "+_('vormerken')+(+SetValue > 0 ? ", "+_('nicht langsamer als $1 km/h') : ""),
		34 		: _('Fahrzeug')+" "+_('Geschwindigkeit')+" "+_('vormerken')+", "+_('nicht schneller als $1 km/h'),
		35 		: _('Fahrzeug')+" "+_('Geschwindigkeit')+" "+_('vormerken')+", "+_('festlegen auf $1 km/h'),

		37 		: _('Fahrzeug')+" "+_('Fahrtrichtungsumkehr')+", "+_('Geschwindigkeit')+" "+_('vormerken')+(+SetValue > 0 ? ", "+_('nicht langsamer als $1 km/h') : ""),
		38 		: _('Fahrzeug')+" "+_('Fahrtrichtungsumkehr')+", "+_('Geschwindigkeit')+" "+_('vormerken')+", "+_('nicht schneller als $1 km/h'),
		39 		: _('Fahrzeug')+" "+_('Fahrtrichtungsumkehr')+", "+_('Geschwindigkeit')+" "+_('vormerken')+", "+_('festlegen auf $1 km/h'),

			128 	: _('Omegas'),
			256 	: _('Sound'),
			512 	: _('Kamera'),
			768 	: _('Immobilie'),
			1024 	: _('DKW/EKW'),
			1280 	: _('Einfahrt Depot'),
			1536 	: _('Ausfahrt Depot'),
			2048 	: _('Animationen'),
			32768 	: _('Gruppen-Kontaktpunkt'),
		}

		const Ziel = KontaktZiele[KontaktZiel];

		let KontaktTypText = (KontaktText[SetType] ? KontaktText[SetType] : _('unbekannt'));

		// Spezielle Kontakt-Typen
		if 		  (SetType == 0) {
			KontaktTypText = Ziel.Typ;

		} else if (SetType >= 1 && SetType <= 39) {		// Fahrzeug
			KontaktTypText = KontaktTypText.replace('$1', SetValue);			// Geschwindigkeit eintragen

		} else if (SetType == 256) {										// Sound
			KontaktTypText += ' ' + Sounds[SetValue];

		} else if (SetType == 512) {
			/* ConnectF: 4 Byte Ganzzahl
				Byte 1 (LSB):	KameraID Start
				Byte 2:			Perspektive Start
				Byte 3:			KameraID Ende
				Byte 4:			Perspektive Ende
			*/
			const Perspektive = {
				0 : _('keine Perspektive festgelegt'),
				1 : _('Fahrzeug von links'),
				2 : _('Fahrzeug von rechts'),
				3 : _('Fahrzeug von links oben'),
				4 : _('Fahrzeug von rechts oben'),
				5 : _('Sicht in Fahrtrichtung'),
				6 : _('Rückwärtige Sicht'),
				7 : _('Folgemodus'),
				8 : _('Sicht in Kabine'),
			}

			// convert 32bit int to array of 4 bytes
			function convertIntToBytes( x ) {
				const bytes = [0, 0, 0, 0,];
				let i = 4;
				do {
					bytes[--i] = x & (255);
					x = x>>8;
				} while ( i && x > 0 )
				return bytes;
			}

			const [EndePerspektive, EndeKameraID, StartPerspektive, StartKameraID] = convertIntToBytes( ConnectF );
			KontaktTypText = _('Kamera')	// Kamera <Start> [<Perspektive>] / <Ende> nach <t> Sek. [<Perspektive>]
				+ (StartKameraID > 0
					? ` <a href="javascript:void(0);" onclick="javascript:postKameraMessage(${StartKameraID});">${KameraNamen[StartKameraID]}<\/a>`
					: '' )
				+ (StartPerspektive > 0
					? ` [${Perspektive[StartPerspektive]}]`
					: '' )
				+ (EndeKameraID > 0
					? ` / <a href="javascript:void(0);" onclick="javascript:postKameraMessage(${EndeKameraID});">${KameraNamen[EndeKameraID]}<\/a> ${('nach')} ${SetValue} ${('Sekunden')}`
					: '' )
				+ (EndePerspektive > 0
					? ` [${Perspektive[EndePerspektive]}]`
					: '' );

		} else if (SetType == 1024) {
			// DKW/EKW Weichenstellung
			const VolDistText = {
				0 : _('Umschalter'),
				1 : _('links-links'),
				2 : _('links-rechts'),
				3 : _('rechts-rechts'),
				4 : _('rechts-links'),
			}

			KontaktTypText += ' ' + VolDistText[VolDist];	// DKW/EKW Weichenstellung
		}

		// SignalData
		/*
		Byte 1 - 2 (LSB)
			Key-ID des abgefragten Signals oder Weiche
		Byte 3 - 4 (MSB)
			Signal- oder Weichenstellung, die gegeben sein muss, damit der Kontakt schaltet
			Signal:
				1=Fahrt
				2=Halt
			Weiche:
				1=Durchfahrt
				2=Abzweig
				3=Koabzweig
			EKW:
				1=von links nach rechts
				2=von rechts nach rechts
				3=von rechts nach links
			DKW:
				1=von links nach links
				2=von links nach rechts
				3=von rechts nach rechts
				4=von rechts nach links
		*/
		const SignalDataStellung = Math.floor(SignalData / 65536);
		const SignalDataID   	 = SignalData - SignalDataStellung * 65536;

		// Zugverband`
		const Zugverband  = Zugverbaende.get(Number(TrainID)); // Zugverbaende.find(function(Zugverband) { return Zugverband.ID == TrainID});
		const Zugverband2 = Zugverbaende.get(Number(TrainID2)); // Zugverbaende.find(function(Zugverband) { return Zugverband.ID == TrainID});

		const TrainSidetext = {
			0 : _('Spitze'),
			1 : _('Schluss'),
			[-1] : _('Gruppen-Kontaktpunkt'),
		}

		fillTable(thead, tbody, [

		{ th : _('Kontakttypcode'),	td : SetType, },
		{ th : _('Kontakttyp'),		td : KontaktTypText, html : true, },		// KontaktText[SetType] mit Modifikation
		{ th : `SetValue`,			td : (SetValue != 0 ? SetValue : '') },
		{ th : _('Kontaktziel'),
			td : (KontaktZiel != null && KontaktZiel != 0 && Ziel
				? 	  `${KontaktZiel}: ${Ziel.Typ} `
					+ `<a href="javascript:void(0);" onclick="javascript:postIDMessage(${Ziel.ID},${Ziel.GleissystemID},${Ziel.GleisID});">`
					+ Ziel.ID
					+ `<\/a> `
					+ _('auf')
					+ ` <a href="javascript:void(0);" onclick="javascript:postGleisMessage(${Ziel.GleissystemID},${Ziel.GleisID});">`
					+ TrackSystemText(Ziel.GleissystemID) + ' ' + Ziel.GleisID
					+ `<\/a>`
				: 	''),
			html : true,
		},
		{ th : _('Gleis'),
			td :  `<a href="javascript:void(0);" onclick="javascript:postKontaktMessage(${KontaktID},${GleissystemID},${GleisID});">`
				+ TrackSystemText(GleissystemID) + ' ' + GleisID
				+ `<\/a>`,
			html : true,
		},
		{ th : `x (m)`,				td : Gleis.PosX.toFixed(0) },
		{ th : `y (m)`,				td : Gleis.PosY.toFixed(0) },
		{ th : _('Position') + ' (m)',		td : Position.toFixed(0) },	// Position
		{ th : _('Auslösung'),
			td : ( fireOnPara == 1 && fireOnAnti == 0 ? (ParaOderAnti == 1 ? _('in Gleisrichtung') : _('gegen Gleisrichtung'))
					: ( fireOnPara == 0 && fireOnAnti == 1 ? (ParaOderAnti == 0 ? _('in Gleisrichtung') : _('gegen Gleisrichtung'))
						: ( fireOnPara == 1 && fireOnAnti == 1 ? _('beide Richtungen') : '' )
					  )
				 )
		},
		{ th : _('Zug-Zähler'),			td : Teiler },
		{ th : _('Zählerstand'),		td : ActTeiler },
		{ th : _('Zeitverzögerung'),	td : Delay },
		{ th : _('Zeit abgelaufen'),	td : ActDelay },
		{ th : _('Zugposition'),		td : (TrainSidetext[TrainSide] ? TrainSidetext[TrainSide] : TrainSide) },
		{ th : _('für Route'),			td : (RouteID != 0 ? RouteID + ': ' + Routen[RouteID] : '') },
		{ th : _('für Zug'),			td : (TrainID  != 0 ? TrainID  + ': ' + (Zugverband  ? Zugverband.Name  : 'nicht vorhanden') : '') },
		{ th : _('auf Zug'),			td : (TrainID2 != 0 ? TrainID2 + ': ' + (Zugverband2 ? Zugverband2.Name : 'nicht vorhanden') : '') },
		{ th : _('Zug-Filter'),			td : NameFilter },
		{ th : _('Neuer Zugname'),		td : TrainNewName },
		{ th : _('zu Stellung'),		td : (zuStellung > 0 && Wechseln == 0 ? zuStellung : (Wechseln == 1 ? _('Umschalter') : '')) },
		{ th : _('SignalData'),			td : (SignalData != 0 ? `ID=${SignalDataID} Stellung=${SignalDataStellung}` : '') },
		{ th : _('AxisPos'),			td : (AxisPos && AxisPos != 0
												? (SetType == 1 // Fahrzeug 
													? _("Achsengruppe") + " " + (-AxisPos)
													: AxisPos 
												  ) 
												: ''
											  ) 
											},
//		{ th : _('Achsenfilter'),		td : (AxisFilter ? AxisFilter : '') },
		{ th : _('LuaFn'),				td : (LuaFn ? LuaFn : '') },
		{ th : _('TipTxt'),				td : (TipTxt ? TipTxt : '') },

		]) })

		return Kontakte.length;
		}
	})

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige der virtuellen Verbindungen
	div = createTable({
		id		: 'virtualConnections',
		title 	: `${_('virtualConnections')} (${virtualConnections.length})`,
		caption	: _('virtualConnections'),
		content	: function(thead, tbody) {

		//virtualConnections.sort(orderByID).forEach(virtualConnection => {
		virtualConnections.forEach(virtualConnection => {

		fillTable(thead, tbody, [

		{ th : _('Gleis'),
			td :
				  `<a href="javascript:void(0);" onclick="javascript:postGleisMessage(${virtualConnection.GleissystemID},${virtualConnection.GleisID1});">`
				+ TrackSystemText(virtualConnection.GleissystemID) + ' ' + virtualConnection.GleisID1
				+ `<\/a>`,
			html : true, },
		{ th : _('Anschluss'),		td : virtualConnection.Anschluss1 	},
		{ th : _('Gleis'),
			td :
				  `<a href="javascript:void(0);" onclick="javascript:postGleisMessage(${virtualConnection.GleissystemID},${virtualConnection.GleisID2});">`
				+ TrackSystemText(virtualConnection.GleissystemID) + ' ' + virtualConnection.GleisID2
				+ `<\/a>`,
			html : true, },
		{ th : _('Anschluss'),		td : virtualConnection.Anschluss2 	},

		]) })

		return virtualConnections.length;
		}
	})

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige der Zugverbände
	div = createTable({
		id		: 'Zugverband',
		title 	: `${_('Zugverbände')} (${Zugverbaende.size})`,
		caption	: _('Zugverbände'),
		content	: function(thead, tbody) {

		Zugverbaende.forEach(Zugverband => { // Zugverbaende.sort(orderByID).forEach(Zugverband => {

		const ZugID			= Zugverband.ID;
		const Name			= Zugverband.Name;
		const Anzahl		= Zugverband.Anzahl;
		const GleissystemID	= Zugverband.Gleisort.getAttribute('gleissystemID');
		const GleisID 		= Zugverband.Gleisort.getAttribute('gleisID');
		const Gleis 		= GleisMap.get(GleissystemID).get(GleisID);
		const Gleisdatei	= Gleis.getAttribute('gsbname');
		const Position		= Zugverband.Gleisort.getAttribute('parameter') / 100; // m
		const ausrichtung 	= Zugverband.Gleisort.getAttribute('ausrichtung');
		const RouteID 		= Zugverband.Zugverband.getAttribute('Route');
		const LastDir 		= Zugverband.Zugverband.getAttribute('LastDir');
		const currentSpeed 	= Zugverband.Zugverband.getAttribute('Geschwindigkeit') * 3600 / 1000; // km/h
		let   targetSpeed 	= Zugverband.Zugverband.getAttribute('sollgeschwindigkeit') * 3600 / 1000; // km/h
		const autopilot 	= Zugverband.Zugverband.getAttribute('autopilot');
		const Hide 			= Zugverband.Zugverband.getAttribute('Hide');

		const waitingTrain 	= waitingTrains[ZugID];
		if (waitingTrain && waitingTrain.speed != 0) {
			targetSpeed = waitingTrain.targetSpeed;
		}
		
		fillTable(thead, tbody, [

		{ th : _('Zugverband'),				td : ZugID },
		{ th : _('Gleis'),	td :
				  `<a href="javascript:void(0);" onclick="javascript:postGleisMessage(${GleissystemID},${GleisID});">`
				+ TrackSystemText(GleissystemID) + ' ' + GleisID
				+ `<\/a>`, html : true, },
		{ th : `x (m)`,						td : Gleis.PosX.toFixed(0) },
		{ th : `y (m)`,						td : Gleis.PosY.toFixed(0) },
		{ th : _('Position') + ' (m)',		td : Position.toFixed(0) },
		{ th : _('Stil'),					td : Gleisdatei },
		{ th : _('Ausrichtung'),			td : (ausrichtung == 1 ? _('in Gleisrichtung') : _('gegen Gleisrichtung')) },
		{ th : _('Name'),					td : Name },
		{ th : _('Anzahl Rollmaterialien'),	td : Anzahl },
		{ th : _('Route'),					td : (RouteID != 0 ? RouteID + ': ' + Routen[RouteID] : '') },
		{ th : _('Geschwindigkeit') + ' km/h',		td : (currentSpeed != 0 ? currentSpeed.toFixed(1) : (LastDir == 1 ? '+0' : '-0')) },
		{ th : _('Sollgeschwindigkeit') + ' km/h',	td : (targetSpeed ? targetSpeed.toFixed(0) : "") },
		{ th : _('Automatik'),				td : autopilot },
		{ th : _('Depot'),					td : Hide },

		]) })

		return Zugverbaende.size;
		}
	})

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
/*

Zeit (Wartender = 0)

<Kontakt Position="4290" ParaOderAnti="1" fireOnPara="1" fireOnAnti="0" Teiler="1" ActTeiler="0" TrainSide="0" Route="0" Route2="0" 
SetType="1536" SetValue="1" 
Delay="0" ActDelay="0" TrainID="0" TrainID2="0" Light="2" LastTrainID="0" LastOfs="0" ConnectF="2" ConnectR="2" VolDist="20" zuStellung="0" 
Wartender="0" 
AxisPos="-1" AxisFilter="" NameFilter="" TrainNewName="" KontaktDist="0" TrainDist="0" LuaFn="" Group="0" AnimID="0" CheckAuto="2" SetAuto="2" 
SignalData="0" 
SigNeg="0" LockEd="0" 
clsid="5E9A3049-D465-4602-A285-6A9774DCF1BF" TipTxt="Zeit" TipBGCR="1" TipBGCG="1" TipBGCB="1" TipFGCR="7.843138E-03" TipFGCG="7.843138E-03" TipFGCB="7.843138E-03" TipShow="1"/>

Auto-Zeit 260 (Wartender > 0, SignalData = 0)

<Kontakt Position="3990" ParaOderAnti="1" fireOnPara="1" fireOnAnti="0" Teiler="1" ActTeiler="0" TrainSide="0" Route="0" Route2="0" 
SetType="1536" SetValue="2" 
Delay="0" ActDelay="0" TrainID="0" TrainID2="0" Light="2" LastTrainID="0" LastOfs="0" ConnectF="2" ConnectR="2" VolDist="20" zuStellung="0" 
Wartender="260" 
AxisPos="-1" AxisFilter="" NameFilter="" TrainNewName="" KontaktDist="0" TrainDist="0" LuaFn="" Group="0" AnimID="0" CheckAuto="2" SetAuto="2" 
SignalData="0" 
SigNeg="0" LockEd="0" 
clsid="5E9A3049-D465-4602-A285-6A9774DCF1BF" TipTxt="Auto-Zeit 260" TipBGCR="1" TipBGCG="1" TipBGCB="1" TipFGCR="7.843138E-03" TipFGCG="7.843138E-03" TipFGCB="7.843138E-03" TipShow="1"/>

Auto-Zeit 330 mit Zufall (Wartender < 0, SignalData = 0)

<Kontakt Position="3990" ParaOderAnti="1" fireOnPara="1" fireOnAnti="0" Teiler="1" ActTeiler="0" TrainSide="0" Route="0" Route2="0" 
SetType="1536" SetValue="3" 
Delay="0" ActDelay="0" TrainID="0" TrainID2="0" Light="2" LastTrainID="0" LastOfs="0" ConnectF="2" ConnectR="2" VolDist="20" zuStellung="0" 
Wartender="-330" 
AxisPos="-1" AxisFilter="" NameFilter="" TrainNewName="" KontaktDist="0" TrainDist="0" LuaFn="" Group="0" AnimID="0" CheckAuto="2" SetAuto="2" 
SignalData="0" 
SigNeg="0" LockEd="0" 
clsid="5E9A3049-D465-4602-A285-6A9774DCF1BF" TipTxt="Auto-Zeit 330 mit Zufall" TipBGCR="1" TipBGCG="1" TipBGCB="1" TipFGCR="7.843138E-03" TipFGCG="7.843138E-03" TipFGCB="7.843138E-03" TipShow="1"/>

Signal 22 (Wartender > 0, SignalData > 0)

<Kontakt Position="3690" ParaOderAnti="1" fireOnPara="1" fireOnAnti="0" Teiler="1" ActTeiler="1" TrainSide="0" Route="0" Route2="0" 
SetType="1536" SetValue="4" 
Delay="0" ActDelay="0" TrainID="0" TrainID2="0" Light="2" LastTrainID="0" LastOfs="0" ConnectF="2" ConnectR="2" VolDist="20" zuStellung="0" 
Wartender="3" 
AxisPos="-1" AxisFilter="" NameFilter="" TrainNewName="" KontaktDist="0" TrainDist="0" LuaFn="" Group="0" AnimID="0" CheckAuto="2" SetAuto="2" 
SignalData="3" 
SigNeg="0" LockEd="0" 
clsid="5E9A3049-D465-4602-A285-6A9774DCF1BF" TipTxt="Signal 3" TipBGCR="1" TipBGCG="1" TipBGCB="1" TipFGCR="7.843138E-03" TipFGCG="7.843138E-03" TipFGCB="7.843138E-03" TipShow="1"/>


Signal 33 zufällig (Wartender > 0, SignalData > 0)

<Kontakt Position="3690" ParaOderAnti="1" fireOnPara="1" fireOnAnti="0" Teiler="1" ActTeiler="1" TrainSide="0" Route="0" Route2="0" 
SetType="1536" SetValue="5" 
Delay="0" ActDelay="0" TrainID="0" TrainID2="0" Light="2" LastTrainID="0" LastOfs="0" ConnectF="2" ConnectR="2" VolDist="20" zuStellung="0" 
Wartender="-3" 
AxisPos="-1" AxisFilter="" NameFilter="" TrainNewName="" KontaktDist="0" TrainDist="0" LuaFn="" Group="0" AnimID="0" CheckAuto="2" SetAuto="2" 
SignalData="3" 
SigNeg="0" LockEd="0" 
clsid="5E9A3049-D465-4602-A285-6A9774DCF1BF" TipTxt="Signal 33 zufällig" TipBGCR="1" TipBGCG="1" TipBGCB="1" TipFGCR="7.843138E-03" TipFGCG="7.843138E-03" TipFGCB="7.843138E-03" TipShow="1"/>

*/
	// Anzeige der Depots
	if (Depots.length > 0) {	// Hide empty table

	div = createTable({
		id		: 'Depot',
		title 	: `${_('Depots')} (${Depots.length})`,
		caption	: _('Depots'),
		content	: function(thead, tbody) {

		//Depots.forEach(Depot => { 
		Depots.sort(orderByID).forEach(Depot => {

		const GleissystemID = Depot.GleissystemID;
		const GleisID 		= Depot.GleisID;
		
		let AutoAuslass = '';
		if ( Depot.Wartender == 0 ) {
			// individuelle Abfahrtzeiten der Zugverbände (Sekunden ab Mitternacht)
			AutoAuslass = _('individuelle Abfahrtzeiten');
			
		} else if ( Depot.Wartender != 0 & Depot.SignalData == 0 ) {
			// Auto-Zeit in Sekunden nach der jeweils der nächste Zugverband ausfährt
			AutoAuslass = _('Auto-Zeit nach') + ' ' + Math.abs(Depot.Wartender) + ' ' + _('Sekunden');
			
		} else if ( Depot.Wartender != 0 & Depot.SignalData != 0 ) {
			// Ausfahrt wird durch Signal gesteuert
			AutoAuslass = _('Signalgesteuert') + ' ' + _('Signal') + ' ' + Depot.SignalData;
		}
		if ( Depot.Wartender < 0 ) {
			AutoAuslass += ', ' + _('Zufall');
		}
		
			fillTable(thead, tbody, [

			{ th : _('Depot'),					td : Depot.ID },
			{ th : _('Gleis'),	td :
					  `<a href="javascript:void(0);" onclick="javascript:postGleisMessage(${GleissystemID},${GleisID});">`
					+ TrackSystemText(GleissystemID) + ' ' + GleisID
					+ `<\/a>`, html : true, },

			{ th : _('Auto-Auslass'), 			td : AutoAuslass },

			{ th : _('Anzahl Zugverbände'),		td : Depot.Trains.length },
			
			])

		})

		return Depots.length;
		}
	})

	// Anzeige der Zugverbände in Depots
	div = createTable({
		id		: 'DepotZugverbaende',
		title 	: `${_('Zugverbände in Depots')}`, // (${Depots.length})`,
		caption	: _('Zugverbände in Depots'),
		content	: function(thead, tbody) {

		Depots.forEach(Depot => { 
		//Depots.sort(orderByID).forEach(Depot => {
		
		let AutoAuslass = '';
		let TTime = 0;
		if ( Depot.Wartender == 0 ) {
			// individuelle Abfahrtzeiten der Zugverbände (Sekunden ab Mitternacht)
			AutoAuslass = _('individuelle Abfahrtzeit');
			
		} else if ( Depot.Wartender != 0 & Depot.SignalData == 0 ) {
			// Auto-Zeit in Sekunden nach der jeweils der nächste Zugverband ausfährt
			AutoAuslass = _('Auto-Zeit nach') + ' ' + Math.abs(Depot.Wartender) + ' ' + _('Sekunden');
			
		} else if ( Depot.Wartender != 0 & Depot.SignalData != 0 ) {
			// Ausfahrt wird durch Signal gesteuert
			AutoAuslass = _('Signalgesteuert') + ' ' + _('Signal') + ' ' + Depot.SignalData;
		}
		if ( Depot.Wartender < 0 ) {
			AutoAuslass += ', ' + _('Zufall');
		}
		
		Depot.Trains.forEach(Train => { // Depot.Trains.sort(orderByID).forEach(Train => {

			const Zugverband = Zugverbaende.get(Number(Train.TTrainId));
			const Status = ( Zugverband ? ( Zugverband.Zugverband.getAttribute('Hide') == 0 ? _('In Fahrt') : _('Warten') ) : '' );

			let TTimeVal;
			if ( Depot.Wartender == 0 ) {
				// individuelle Abfahrtzeiten der Zugverbände (Sekunden ab Mitternacht)
				TTimeVal = new Date(1000 * Math.abs(Train.TTime)).toISOString().substr(11, 8)	// seconds -> hh:mm:ss
				
			} else if ( Depot.Wartender != 0 & Depot.SignalData == 0 ) {
				// Auto-Zeit in Sekunden nach der jeweils der nächste Zugverband ausfährt
				TTime += Math.abs(Depot.Wartender);
				TTimeVal = new Date(1000 * Math.abs(TTime)).toISOString().substr(11, 8)	// seconds -> hh:mm:ss
				
			} else if ( Depot.Wartender != 0 & Depot.SignalData != 0 ) {
				// Ausfahrt wird durch Signal gesteuert
				TTimeVal = '';
			}		

			fillTable(thead, tbody, [

			{ th : _('Depot'),					td : Depot.ID },
			
			{ th : _('Status'),					td : Status },
			{ th : _('Abfahrtzeit'), 			td : TTimeVal },
			{ th : _('Auto-Auslass'), 			td : AutoAuslass },
			//{ th : _('Zugverband'),			td : Train.TTrainId },
			{ th : _('Zugverband'),				td : ( Zugverband ? Zugverband.Name : "" ) },
			{ th : _('Route'),					td : Routen[Train.TRouteId] },
			{ th : _('Richtung'),				td : ( Train.TDir == 0 ? _('eins') : _('zwei') )},
			{ th : _('Geschwindigkeit') + ' km/h',	td : Train.TSpeed },

			])
		}) 

		// No trains in Depot
		if (Depot.Trains.length == 0) {
			fillTable(thead, tbody, [

			{ th : _('Depot'),					td : Depot.ID },
			{ th : _('Auto-Auslass'), 			td : AutoAuslass },
			
			{ th : _('Status'),					td : '' },
			{ th : _('Abfahrtzeiten'), 			td : '' },
			//{ th : _('Zugverband'),			td : '' },
			{ th : _('Zugverband'),				td : '' },
			{ th : _('Route'),					td : '' },
			{ th : _('Richtung'),				td : '' },
			{ th : _('Geschwindigkeit') + ' km/h',	td : '' },
			])
		}

		})

		return Zugverbaende.size;
		}
	})

	} // Depots.length > 0
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige der Rollmaterialien
	/*
<Rollmaterial 
x	clsid="16095510-0EAB-46AF-B294-CBB6D3516007" 	-> mit Antrieb
x	clsid="7B0D0A3A-0882-44D6-B3E7-45D933A70F74" 	-> ohne Antrieb
x	ausrichtung="1" 				Ausrichtung des Zugverbands (1=in Gleisrichtung, 0=entgegen der Gleisrichtung) 
	bremsung="8.000001E-02" 		Aktuelle Bremseinstellung (von 0 bis 1) 
	Flags="140" 					zusätzliche Eigenschaften (Bitarray) 140 = Straßenfahrzeug, 12 = anderes Fahrzeug
	Masse="12400" 					Masse in Kilogramm 
	Reibung="12.13" 				Reibung in Kilonewton ungebremst 
	maxbremsung="125" 				Maximale Bremskraft in Kilonewton 
x	vUeberhang="480" 				Vorderer Überhang in cm (ausgehend vom vorderen Radsatz) 
x	hUeberhang="560" 				Hinterer Überhang in cm (ausgehend ebenfalls vom vorderen Radsatz) 
	TotalDist="27119" 
x	name="Claas Tucano 440 gelb" 	Eindeutiger Name des Rollmaterials 
x	typ="STRASSE\LANDWIRTSCHAFT\CLAAS_TUCANO_440_GB_V102_SM2.3dm" 
	LightStat="-218234880" 			Status des Beleuchtung 
	Hook="0" 						immer 0, keine Funktion zu erkennen 
	Active="1" 
x	RollIdx="3" 
	Favorite="0" 
	ActCabin="1" 
	ImmoIdx="0" 					Verweis auf zugehöriges Gleisobjekt des befahrbaren Rollmaterials 
	zuStellung="0" 					1=Rollmaterial bei nächster Gleisverbindung anschließen, sonst 0
	Wartender="0" 					Anzahl an Rollmaterialien entladen
	LockEd="0"
	>
	<Zugmaschine 
		leistung="0" 				Aktuelle Leistung (von 0 bis 1) 
		gang="2"					Aktuell gewählter Gang 
		>
		<Motor 
			leistung="310" 			Motorleistung in Kilowatt 
			u1="300" 				Untere Drehzahlgrenze in Umdrehungen pro Minute 
			u2="750" 				Obere Drehzahlgrenze in Umdrehungen pro Minute 
			u3="1000"				Maximale Drehzahl in Umdrehungen pro Minute 
		/>
		<Getriebe 
			treibradradius="100"	Radius der angetriebenen Achsen 
			>
			<Gang 
				uebersetzung="-24"	Übersetzungsverhältnis des jeweiligen Ganges. Negative Werte = Rückwärtsgang. 
			/>
			<Gang 
				uebersetzung="24"
			/>
			<Gang 
				uebersetzung="16"
			/>
			<Gang 
				uebersetzung="12"
			/>
		</Getriebe>
	</Zugmaschine>
	<Modell>
		<Achse Parameter="0" Velocity="0.0002"/>
		<Achse Parameter="0" Velocity="0.0002"/>
		<Achse Parameter="0" Velocity="0.0002">
			<Achse Parameter="11.86824" Velocity="0.0002"/>
			<Achse Parameter="11.86824" Velocity="0.0002"/>
			...
		</Achse>
		...
	</Modell>
	<AxisPreset>
		<Table Count="3" e0="0" e1="0" e2="4.08407"/>
    </AxisPreset>
</Rollmaterial>
*/			

	const clsidPropelled 	= "16095510-0EAB-46AF-B294-CBB6D3516007";
	const clsidNotPropelled	= "7B0D0A3A-0882-44D6-B3E7-45D933A70F74";

	div = createTable({
		id		: 'Rollmaterial',
		title 	: `${_('Rollmaterialien')} (${Rollmaterialien.length})`,
		caption	: _('Rollmaterialien'),
		content	: function(thead, tbody) {

		Rollmaterialien.sort(orderByName).forEach(Rollmaterial => {

		const Name			= Rollmaterial.Name;
		const RollIdx		= Rollmaterial.Rollmaterial.getAttribute("RollIdx");
		const clsid			= Rollmaterial.Rollmaterial.getAttribute("clsid");
		const vUeberhang	= Rollmaterial.Rollmaterial.getAttribute("vUeberhang");
		const hUeberhang	= Rollmaterial.Rollmaterial.getAttribute("hUeberhang");
		const File			= Rollmaterial.Rollmaterial.getAttribute("typ");

		const ZugverbandName = Rollmaterial.Zugverband.getAttribute('name');
		const Position		= Rollmaterial.Position;
		const ausrichtung	= Rollmaterial.Rollmaterial.getAttribute("ausrichtung");

		const Zugmaschine	= Rollmaterial.Rollmaterial.getElementsByTagName("Zugmaschine")[0];
		const Motor			= (Zugmaschine ? Zugmaschine.getElementsByTagName("Motor")[0] : false);
		const leistung		= (Motor ? Motor.getAttribute("leistung") : 0);

		const Achsen		= Rollmaterial.Rollmaterial.querySelectorAll('Modell > Achse');
		const AxisPresets	= Rollmaterial.Rollmaterial.getElementsByTagName('AxisPreset');
		
		// AxisPreset
		let AxisPresetText = '';
		let AxisPresetNr = 0;
		for (const AxisPreset of AxisPresets) {
			AxisPresetNr += 1;
			if (AxisPresetText !== '') {
				AxisPresetText += '<br>';
			}
			AxisPresetText += '[' + AxisPresetNr + ']';
			const Table		= AxisPreset.getElementsByTagName('Table')[0];
			const Count		= Table.getAttribute('Count');
			for (let Axis = 0; Axis < Count; Axis++) {
				const value = Table.getAttribute('e'+Axis);
				if (value === '1') {					// Switch axis
					AxisPresetText += ' ' + (Axis+1) + '=' + _('An');
				} else if  (value > 0.05) {
					const pos = value/Math.PI/2*100;	// Rotation axis  
					AxisPresetText += ' ' + (Axis+1) + '=' + pos.toFixed(0) + '%';
				}
			}
		}

		fillTable(thead, tbody, [

		{ th : _('Name'),					td : Name },
		{ th : _('RollIdx'),				td : RollIdx },

		{ th : _('Angetrieben'),			td : (clsid === clsidPropelled ? 1 : 0) },
		{ th : _('Leistung'),				td : leistung },

		{ th : _('vUeberhang'),				td : vUeberhang },
		{ th : _('hUeberhang'),				td : hUeberhang },

		//{ th : _('Anzahl Achsen'),			td : Achsen.length }, // The total count of axis is greater than the count of movable axis

		{ th : _('Zugverband'),				td : ZugverbandName },
		{ th : _('Position'),				td : Position },
		{ th : _('Ausrichtung'),			td : ausrichtung },
		{ th : _('Achsengruppe'),			td : AxisPresetText, html : true },

		{ th : _('Datei'),					td : File },

		]) })

		return Rollmaterialien.length;
		}
	})

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige der Gleisstile
	div = createTable({
		id		: 'Gleisstil',
		title 	: `${_('Gleisstile')} (${Gleisstile.length})`,
		caption	: _('Gleisstile'),
		content	: function(thead, tbody) {

		Gleisstile.sort(orderByID).forEach(Gleisstil => {

		fillTable(thead, tbody, [

		{ th : _('Stil'),			td : Gleisstil.ID 		},
		{ th : _('Datei'),			td : Gleisstil.Name 	},
		{ th : _('Anzahl'),			td : Gleisstil.Anzahl 	},

		]) })

		return Gleisstile.length;
		}
	})

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige der Gleisobjekte
	div = createTable({
		id		: 'Gleisobjekt',
		title 	: `${_('Gleisobjekte')} (${Gleisobjekte.length})`,
		caption	: _('Gleisobjekte'),
		content	: function(thead, tbody) {

		//Gleisobjekte.forEach(Gleisobjekt => {
		Gleisobjekte.sort(orderByID).forEach(Gleisobjekt => {

		const Dreibein	= Gleisobjekt.Kollektor.getElementsByTagName("Dreibein")[0];
		const FramePos	= Dreibein.getElementsByTagName("Vektor")[0];

		const PosX		= +FramePos.getAttribute("x") / 100;
		const PosY		= +FramePos.getAttribute("y") / 100;
		const PosZ		= +FramePos.getAttribute("z") / 100;

		const Gleise	= Gleisobjekt.Kollektor.getElementsByTagName("Gleis");

		const GebaudesammlungID = Gleisobjekt.Kollektor.GebaudesammlungID || '';
		const ImmoIdx			= Gleisobjekt.Kollektor.ImmoIdx || '';
		const File				= Gleisobjekt.Kollektor.gsbname || '';

		let GleissystemID;
		let GleiseText;
		for (const Gleis of Gleise) {

			const GleisSysID = Gleis.getAttribute('gleissystemID');
			const GleisID 	= Gleis.getAttribute('gleisID');

			// Check GleissystemID
			if (GleissystemID && GleissystemID != GleisSysID ) {
				console.log('Kollektor'
					+ ' ' + Gleisobjekt.ID
					+ ' GleissystemID ' + GleissystemID + " != " + GleisSysID
				);
			}
			GleissystemID = GleisSysID;

			if (!GleiseText) {
				GleiseText = TrackSystemText(GleissystemID);
			}
			GleiseText += ' '
				+ `<a href="javascript:void(0);" onclick="javascript:postGleisMessage(${GleissystemID},${GleisID});">`
				+ GleisID
				+ `<\/a>`;
		}


		fillTable(thead, tbody, [

		{ th : _('Gleisobjekt'),	td :
			`<span id="Gleisobjekt_${Gleisobjekt.ID}">${Gleisobjekt.ID}<\/span>`
			, html : true },
		{ th : _('Anzahl Gleise'),	td : Gleise.length				},
		{ th : _('Gleise'),			td : GleiseText, html : true	},
		{ th : `x (m)`,				td : PosX.toFixed(0) 			},
		{ th : `y (m)`,				td : PosY.toFixed(0) 			},
		{ th : _('Immobilie'),		td :
			//GebaeudesammlungText[GebaudesammlungID] + ' ' +
			ImmoIdx
			},
		{ th : _('Datei'),			td : File		},

		]) })

		return Gleisobjekte.length;
		}
	})

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige der Kameras
	div = createTable({
		id		: 'Kamera',
		title 	: `${_('Kameras')} (${Kameras.length})`,
		caption	: _('Kameras'),
		content	: function(thead, tbody) {

		//Kameras.forEach(Kamera => {
		Kameras.sort(orderByName).forEach(Kamera => {

		const Dreibein	= Kamera.Kamera.getElementsByTagName("Dreibein")[0];
		const FramePos	= Dreibein.getElementsByTagName("Vektor")[0];
		const FrameDir	= Dreibein.getElementsByTagName("Vektor")[1];

		const PosX		= +FramePos.getAttribute("x") / 100;
		const PosY		= +FramePos.getAttribute("y") / 100;
		const PosZ		= +FramePos.getAttribute("z") / 100;

		const Dynamic 	= Kamera.Kamera.getAttribute("Dynamic");

		fillTable(thead, tbody, [

		{ th : _('Kamera'),		td :
			`<a id="Kamera_${Kamera.ID}" href="javascript:void(0);" onclick="javascript:postKameraMessage(${Kamera.ID});">${Kamera.ID}<\/a>`
			, html : true },
		{ th : `Name`,				td :
			`<a  href="javascript:void(0);" onclick="javascript:postKameraMessage(${Kamera.ID});">${Kamera.Name}<\/a>`
			, html : true },
		{ th : `x (m)`,				td : PosX.toFixed(0) 			},
		{ th : `y (m)`,				td : PosY.toFixed(0) 			},
		{ th : `z (m)`,				td : PosZ.toFixed(0) 			},
		{ th : _('Kameratyp'),		td : (Dynamic == 0 ? _('statisch') : _('dynamisch')) },

		]) })

		return Kameras.length;
		}
	})

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Anzeige der GBS
	div = createTable({
		id		: 'GBS',
		title 	: `${_('Stellpulte')} (${GBS_table.length})`,
		caption	: _('Stellpulte'),
		content	: function(thead, tbody) {

		//GBS_table.forEach(GBS => {
		GBS_table.sort(orderByID).forEach(GBS => {

		fillTable(thead, tbody, [

		{ th : _('Stellpult'),		td :
			`<a id="GBS_${GBS.ID}" href="javascript:void(0);" onclick="javascript:postGBSMessage(${GBS.ID});">${GBS.ID}<\/a>`
			, html : true },
		{ th : `Name`,				td :
			`<a  href="javascript:void(0);" onclick="javascript:postGBSMessage(${GBS.ID});">${GBS.Name}<\/a>`
			, html : true },

		{ th : _('Gleissystem'),	td : TrackSystemText(GBS.GleissystemID) },
		{ th : _('Breite'),			td : GBS.Width			 		},
		{ th : _('Höhe'),			td : GBS.Height 				},

		{ th : _('ImmoIdx'),		td : GBS.ImmoIdx			 	},
		{ th : `x (m)`,				td : GBS.PosX.toFixed(0) 		},
		{ th : `y (m)`,				td : GBS.PosY.toFixed(0) 		},
		{ th : `z (m)`,				td : GBS.PosZ.toFixed(0) 		},
		{ th : _('Datei'),			td : GBS.gsbname			 	},

		]) })

		return GBS_table.length;
		}
	})

	showGBS( GBS_table, div );
	
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

	// Allow to sort all tables by clicking on the header
	prepareSort();
	

// Show graphic for GBS
// requires TrackSystemText
function showGBS( GBS_table, div ) {

	//const svgGBS 		= document.getElementById('svgGBS');
	const svgNS 	= 'http://www.w3.org/2000/svg';
	const xlinkNS 	= 'http://www.w3.org/1999/xlink';
	const scale = 100;

	GBS_table.sort(orderByID).forEach(GBS => {

		const title = e(div, 'p');
		e(title, 'b',
			`${_('Stellpult')} ${GBS.ID} '${GBS.Name}' ${_('auf')} ${TrackSystemText(GBS.GleissystemID)} (${GBS.Width} x ${GBS.Height})`
		);

		// Create svg for the GBS
		const svg = document.createElementNS(svgNS, 'svg');
		div.appendChild(svg);
		svg.setAttributeNS(svgNS, 'viewBox', '0 0 ' + scale * GBS.Width + ' ' + scale * GBS.Height );
		svg.setAttribute('width',  scale * GBS.Width );
		svg.setAttribute('height', scale * GBS.Height );
		
		// Add empty tiles
		for (let x = 1; x <= GBS.Width; x++) {
			for (let y = 1; y <= GBS.Height; y++) {
				// Add tile to svg
				createTile(svg, 0, x, y);
			}
		}
		
		GBS.Tiles.sort(orderByID).forEach(Tile => {

			// Add track to svg
			if (Tile.TrackSymbol > 0) {

				// Check switch ID
				let Gleissystem, Gleis;
				Gleissystem = GleisMap.get(GBS.GleissystemID);
				if (Gleissystem) {
					Gleis = Gleissystem.get(Tile.Tracks[0]);
				}
				if (Gleis) {
					const Key_Id = Gleis.getAttribute('Key_Id');
					if (Tile.SwitchID != Key_Id) {
						console.log( 'Tile.SwitchID != Key_Id',
							"(", Tile.x, Tile.y, ")",
							Tile.SwitchID, "!=", Key_Id
						);
					}
				}
			
				// Construct tipp text and tile
				if (Tile.TrackSymbol == 36) {
					const titleText = (Tile.Kammera       ? _('Kamera') + " " + Tile.Kammera : "");
					createTile(svg, Tile.TrackSymbol, Tile.x, Tile.y, titleText, Tile.Kammera);

				} else {
					const titleText = 
					  (Tile.SwitchID       ? _('Weiche') + " " + Tile.SwitchID + " ": "")  		
					+ _('Gleise')  		
					+ (Tile.Tracks[0] > 0 ? " "  + Tile.Tracks[0] : "")
					+ (Tile.Tracks[1] > 0 ? ", " + Tile.Tracks[1] : "")
					+ (Tile.Tracks[2] > 0 ? ", " + Tile.Tracks[2] : "")
					+ (Tile.Tracks[3] > 0 ? ", " + Tile.Tracks[3] : "");

					createTile(svg, Tile.TrackSymbol, Tile.x, Tile.y, titleText, Tile.SwitchID);
				}
			
			}	
			
			// Add signal overlay to svg
			if (Tile.Signal_left  > 0) {
				const titleText = _('Signal') + " " + (Tile.SignalID_left  > 0 ? Tile.SignalID_left  : null);
				createTile(svg, Tile.Signal_left, Tile.x, Tile.y, titleText, Tile.SignalID_left,   'left');
			}
			if (Tile.Signal_mid   > 0) {
				const titleText = _('Signal') + " " + (Tile.SignalID_mid   > 0 ? Tile.SignalID_mid   : null);
				createTile(svg, Tile.Signal_mid,   Tile.x, Tile.y, titleText, Tile.SignalID_mid,   'mid');
			}
			if (Tile.Signal_right > 0) {
				const titleText = _('Signal') + " " + (Tile.SignalID_right > 0 ? Tile.SignalID_right : null);
				createTile(svg, Tile.Signal_right, Tile.x, Tile.y, titleText, Tile.SignalID_right, 'right');
			}
		
		})

	})
	
	function createTile(svg_tag, TrackSymbol, x, y, titleText = null, ID = null, pos = null) {

		// Create group for the tile
		const g_tag = document.createElementNS(svgNS, 'g');
		svg_tag.appendChild(g_tag);

		// Calculate position
		// Adjustment for signals
		let hpos = 0;
		if ( TrackSymbol >= 26 && TrackSymbol <= 31) { // Shift postion in case of signals
			if        ( pos === 'left' ) {
				hpos = - scale / 3;
			} else if ( pos === 'right' ) {
				hpos = + scale / 3;
			}
		}
		// Set position 
		g_tag.setAttribute('transform', 
			'translate('
			+ ( scale * ( x - 1) + hpos )
			+ ' '
			+ ( scale * ( y - 1) )
			+ ')'
			);

		// Create tile
		const use_tag = document.createElementNS(svgNS, 'use');
		use_tag.setAttributeNS(xlinkNS, 'xlink:href', '#Tile_' + TrackSymbol );
		use_tag.setAttribute('width',  scale );
		use_tag.setAttribute('height', scale );
		g_tag.appendChild(use_tag);

		// Create title for tile
		if (titleText) {
			const title_tag = document.createElementNS(svgNS, 'title');
			const titleNode = document.createTextNode(titleText);
			title_tag.appendChild(titleNode);
			use_tag.appendChild(title_tag);
		}

		// Create text for switch or signal
		if (ID) {

			// Create text
			const textNode = document.createTextNode(ID);
			const text_tag = document.createElementNS(svgNS, 'text');
			text_tag.setAttribute('class', 'IDtext'); 
			text_tag.appendChild(textNode);

			// Create link for Gleisplan program
			const a_tag = document.createElementNS(svgNS, 'a');
			a_tag.setAttribute('href', 'javascript:void(0);');
			a_tag.appendChild(text_tag);
			g_tag.appendChild(a_tag);
			
			if ([36].includes(TrackSymbol)) {	// Camera
				// Identify KameraID
				let KameraID;
				for (const Kamera of Kameras) {
					if (ID == Kamera.Name) {
						KameraID = Kamera.ID;
						break;
					}; 
				}; 
			
				//Construct link
				// `<a href="javascript:void(0);" onclick="javascript:postKameraMessage(${KameraID});">${ID}<\/a>`
				a_tag.setAttribute('onclick', 
					'javascript:postKameraMessage(' + KameraID + ');'
				);

			} else {	// Signal or switch 

				// Get GleisID
				let GleissystemID, GleisID;

				if ([26, 27, 28, 29, 30, 31].includes(TrackSymbol)) {	// Signals
					for (const Signal of Signale) {
						if (ID == Signal.ID) {
							GleissystemID = Signal.GleissystemID;
							GleisID = Signal.GleisID;
							break;
						}; 
					}; 
					
				} else { // Switches
					for (const Weiche of Weichen) {
						if (ID == Weiche.ID) {
							GleissystemID = Weiche.GleissystemID;
							GleisID = Weiche.GleisID;
							break;
						}; 
					}; 
				}
					
				//Construct link
				// `<a href="javascript:void(0);" onclick="javascript:postIDMessage(${ID},${GleissystemID},${GleisID});">${ID}<\/a>`
				a_tag.setAttribute('onclick', 
					'javascript:postIDMessage(' + ID + ',' + GleissystemID + ',' + GleisID + ');'
				);
			}
			// else // Track
			// `<a href="javascript:void(0);" onclick="javascript:postGleisMessage(${GleissystemID},${GleisID});">${ID}<\/a>`

			// Calculate middle position
			let dx = scale / 2;
			let dy = scale / 2;

			// Move text of signals
			if ([26, 28, 30].includes(TrackSymbol)) {
				dy -= 15;
			} 
			if ([27, 29, 31].includes(TrackSymbol)) {
				dy += 41;
			} 
			
			// Move text of camera
			if ([36].includes(TrackSymbol)) {
				dy += 39;
			} 
			
			let transform = 'translate(' + ( dx ) + ' ' + ( dy ) + ')';
			
			// Rotate text depending on TrackSymbol of a switch
			if ([19, 18, 40, 41, 57].includes(TrackSymbol)) {
				transform += ' ' + 'rotate(-45)';
			}
			if ([17, 16, 43, 42, 56].includes(TrackSymbol)) {
				transform += ' ' + 'rotate(45)';
			}
			if ([52, 53, 54, 55].includes(TrackSymbol)) {
				transform += ' ' + 'rotate(-90)';
			}
			
			text_tag.setAttribute('transform',  transform );
		}
	}	
} 
	
	
}

function orderByID(a,b) {
	// Sort by number ascending
	return (a.ID - b.ID);
}
function orderByName(a,b) {
	// Sort by text ascending
	const NameA = a.Name.toLowerCase(), NameB = b.Name.toLowerCase();
	if (NameA < NameB)	{ return -1; }
	if (NameA > NameB)	{ return 1;  }
	return 0;
}

// Create output table
function createTable( tab ) {
	const div 	= 	e(null,	 'div'					);
					e(div, 	 'h4', 		tab.title	);
	const table = 	e(div, 	 'table' 				);
	//				e(table, 'caption', tab.caption );  // TableFilter uses the caption already
	const thead	= 	e(table, 'thead' 				);
	const tbody	= 	e(table, 'tbody' 				);

	div.classList.add(tab.id);
	div.setAttribute('id', 'div'+tab.id);
	table.setAttribute('id', tab.id);

	// Now, let's do it
	const count = tab.content(thead, tbody);

	if (count > 0) {

	// Activate table filter (see http://www.tablefilter.com/examples.html )
	// Configuration via statements instead of object: http://www.tablefilter.com/features-no-configuration.html
	// Feature toggle: http://www.tablefilter.com/toggle-features.html
	const cfg = {
		//base_path: 'https://www.tablefilter.com/tablefilter/',
		base_path: 'node_modules/tablefilter/dist/tablefilter/',

		//themes: [{ name: 'skyblue' }],	// Themes 'default', 'skyblue', 'transparent', 'mytheme'

		auto_filter: { delay: 500 },	// Delay for automatic filtering (milliseconds)

		state: {						// Enable state persistence (see http://www.tablefilter.com/persistence.html for more options)
			types: ['local_storage'],	// Mögliche Werte: 'local_storage' 'hash' or 'cookie' (erfordert id für Tabellen)
			filters: true,				// Persist filters values, enabled by default
			columns_visibility: true,	// Persist columns visibility
			filters_visibility: true,	// Persist filters row visibility
		},

		sticky_headers: true,			// Sticky headers with overrides
		alternate_rows: true,			// Enable alternating rows
		mark_active_columns: {			// Mark active columns
			highlight_column: false,	// Highlight columns or only header
        },
		grid_layout: false,				// Grit layout (but no simple copy&paste to Excel anymore)
		filters_row_index: 0,  			// Row index to show the filter bar (default 0). Show filter bar above header allows easy copy&paste of the table content.

		toolbar: true,					// Enable toolbar component
		rows_counter: { text: tab.caption + ': ' },	// Enable rows counter UI component
		status_bar: {					// Enable status bar UI component
			msg_filter: _('Filter aktiv') + ' ...',	// Message during filtering
			toolbar_position: 'center',	// Default position in toolbar ('left'|'center'|'right')
		},
		btn_reset: {  					// Enable clear button
			tooltip: _('Filter löschen'),
			toolbar_position: 'right',	// Default position in toolbar ('left'|'center'|'right')
		},

		locale: 'de',					// Define default locale, default to 'en' // ###
		thousands_separator: '.',		// Define thousands separator ',' or '.', defaults to ','
		decimal_separator: ',',			// Define decimal separator ',' or '.', defaults to '.'

		empty_operator: '[empty]',
		nonempty_operator: '[nonempty]',
		help_instructions: {			// Instructions text (accepts HTML)
			text :
            _('Filter-Operatoren') + ':<br> '
            + `<b>&lt;<\/b>, <b>&lt;=<\/b>, <b>=<\/b>, <b>&gt;=<\/b>, <b>&gt;<\/b>, <br>`
            + `<b>*<\/b>, <b>!<\/b> (${_('nicht')}), <b>{<\/b> (${_('beginnt mit')}), <b>}<\/b> (${_('endet mit')}), <br>`
            + `<b>||<\/b> (${_('oder')}),<b> &amp;&amp;<\/b> (${_('und')}),<br>`
            + `<b>[empty]<\/b>, <b>[nonempty]<\/b>, <b>rgx:<\/b><br>`
            + '<a href="'
			+ 'https://github.com/koalyptus/TableFilter/wiki/4.-Filter-operators'
			+ '" target="_blank">'
            + _('Weitere Informationen') + '</a><hr/>'
			,
			btn_text : '?',				// btn_text oder btn_html
		},

		no_results_message: {			// "No results" message
			content: _('Keine zum Filter passende Einträge vorhanden'),
		},
		loader: false,					// Loading indicator, { html : '...' }
		watermark: [ _('Filter') + ' ...', ],	// Repeated watermark text for input fields or watermark for each filter if an array is supplied

		extensions:[					// Extensions load addititional script files
			{
				name: 'colsVisibility',
				description: _('Sichbarkeit der Spalten verwalten'),	// Module description
				enable_hover: true,		// Enable hover behaviour on columns manager button/link
				btn_text: _('Spalten verstecken') + '&#9660;',	// Button's text, defaults to Columns&#9660;
				//at_start: [3, 4],		// List of columns indexes to be hidden at initialization
				tickToHide: true,		// Enable tick to hide a column, defaults to true
				text: _('Versteckte Spalten') + ': ', // Text preceding the columns list, defaults to 'Hide' or 'Show'
				btn_close_text: _('Schließen'),	// Columns manager UI close link text, defaults to 'Close'
				enable_tick_all: false,	// Enable select all option, disabled by default
				tick_all_text: _('Alle auswählen') + ':',	// Text for select all option, defaults to 'Select all:'
				toolbar_position: 'right',	// Default position in toolbar ('left'|'center'|'right')
			},
			/*
			{
				name: 'filtersVisibility',
				description: _('Sichtbarkeit der Filter'),		// Module description
				visible_at_start: true,	// Make filters visible at initialization, defaults to true
				enable_icon: true,		// Enable expand/collapse icon, defaults to true
				btn_text: _('Filter'),		// Custom text for button
				toolbar_position: 'right',	// Default position in toolbar ('left'|'center'|'right')
			},
			*/
			//{ name: 'sort' }			// Sort requires to classify numeric columns using "col_types : [ 'numeric', String', ...]," see http://www.tablefilter.com/sort.html
		],
	}
	const tf = new TableFilter(table, cfg);
	tf.init();

	}

	return div;
}

// Fill output table
function fillTable(thead, tbody, lines ) {
	let thead_tr;

	const first = (thead.rows.length == 0);
	if (first) {
		thead_tr = e(thead, 'tr' );
	}

	const tbody_tr = e(tbody,	'tr');
	for (const line of lines) {
		if (first) {
			e(thead_tr, 'th', line.th);
		}
		e(tbody_tr, 'td', line.td, line.html);
	}
}

// Element erzeugen und anhängen
function e(target, tagName, content, html) {
	const element = document.createElement(tagName);
	if (content) {
		if (html) {	element.innerHTML 	= content; }
		else 	  { element.textContent = content; }
	}
	if (!target) { target = document.getElementById('container') }
	target.appendChild(element);
	return element;
}

// Sort table, https://stackoverflow.com/questions/14267781/sorting-html-table-with-javascript
function prepareSort() {

	function getCellValue(tr, idx){
		return tr.children[idx].innerText || tr.children[idx].textContent;
	}

	function comparer(idx, asc) {
		return function(a, b) {
			return function(v1, v2) {
				return v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2);
			}(getCellValue((asc ? a : b), idx), getCellValue((asc ? b : a), idx));
		}
	}

	// prepare the work...
	document.querySelectorAll('th').forEach(
		th => th.addEventListener('click', (() => {
			const table = th.closest('table');
			const tbody = table.querySelector('tbody');
			Array.from(tbody.querySelectorAll('tr'))
				.sort(comparer(Array.from(th.parentNode.children).indexOf(th), th.asc = !th.asc)) // th.asc instead of this.asc to allow strict mode
				.forEach(tr => tbody.appendChild(tr) );
		}))
	);
}
</script>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<script type="text/javascript"> // html page
"use strict";
// Toggle visibility of elements
function toggleElements(selector, visible) {
	for (const ele of document.getElementById('container').querySelectorAll(selector)) {
		if (visible) {
			ele.classList.remove('hidden');
		} else {
			ele.classList.add('hidden');
		}
	}
}

</script>
<style>
/* Selection screen */
#fileselector {
	margin: 15px;
}
#fileselector span.li {
	display: list-item;
	padding-top: 0.2em;
	margin-left: 2em;
}

/* html page */
.hidden {
	display: none;
}

table {
	border-collapse: collapse;
}

caption {
  /* display: none;	*/
}

thead {
	font-weight: bold;
	background-color:#C5D8E1;
}

th {
	border: 1px solid gray;
	padding: 5px;
	cursor: n-resize; /* Cursor indicating sorting */
}

tbody {
	vertical-align: top;
}

tr {
}

tr:nth-child(even) {
  /* background-color: #ECF2F5; */
}

td {
	border: 1px solid gray;
	padding: 5px;
}

.fieldset {
	border-width: 0;
	margin-inline-start: 0;
	margin-inline-end: 0;
	padding-block-start: 0;
	padding-inline-start: 0;
	padding-inline-end: 0;
	padding-block-end: 0;
}
.fieldset .item {
	white-space: nowrap;		/* keep checkbox and label together */
	display: inline;			/* but do no add extra line breaks per item */
}

/* no select/copy to clipboard. Firefox prevents selection even in case of Ctrl-A, but with Chrome it's not relilaby. */
.no-select,
fieldset,
select,
input,
label,
button {
	user-select: none;
}
</style>

</head>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<body>

<section id='fileselector'>
<header class="flexRow"><!-- Show heading and language selection buttons, see EEP_Texts.css -->
<div> <!-- left part -->
<h3><span lang="de">EEP-Inventar</span><span lang="en">EEP Inventory</span><span lang="fr">EEP Inventaire</span></h3>
</div>

<div> <!-- right part -->
<label for="german" class="langBtn">Deutsch</label>
<label for="english" class="langBtn">English</label>
<label for="french" class="langBtn">Français</label>
</div>
</header>

<form action='#' onsubmit='return false;'> <!-- better not to use inline listener, explizit register is better -->
<label for="fileinput">
<span lang="de">Wähle (auch mit Drag&amp;Drop möglich) und lade eine EEP-Anlage-Datei (.anl3).</span>
<span lang="en">Select (or use Drag&amp;Drop) and load an EEP file (.anl3).</span>
<span lang="fr">Sélectionnez un réseau EEP (nom_du_réseau.anl3) ou utilisez la fonction glisser-déposer.</span>
</label>
	<input type='file' id='fileinput' accept='.anl3' onchange='loadFile(this.files && this.files[0])' />
	<!-- An extra button is not neccessary -->
	<!-- <input type='button' id='btnLoad' value='Load' onclick='loadFile();'> -->
</form>

<article>

<p lang="de">Dieses Programm nutzt die Javascript-Funktion <a href='https://www.w3schools.com/xml/xml_parser.asp' target='_blank'>DOMParser</a> um eine <i>.anl3</i>-Datei von EEP, die aus <a href='https://www.w3schools.com/xml/xml_tree.asp' target='_blank'>XML</a> aufgebaut ist, zu interpretieren und in das <a href='https://www.w3schools.com/xml/xml_dom.asp' target='_blank'>Document Object Model (DOM)</a> umzuwandeln.<br>
Anschließend wird der Inhalt in verschiedenen Tabellen ausgegeben.</p>

<p lang="en">This program uses the Javascript function <a href="https://www.w3schools.com/xml/xml_parser.asp" target="_blank">DOMParser</a> to analyse an <i>.anl3</i> file of EEP,  which contains <a href="https://www.w3schools.com/xml/xml_tree.asp" target="_blank">XML</a> structured data, and to transform it into the <a href="https://www.w3schools.com/xml/xml_dom.asp" target="_blank">Document Object Model (DOM)</a>.<br>
The content is then displayed in various tables.</p>

<p lang="fr">Ce programme utilise la fonction javascript <a href="https://www.w3schools.com/xml/xml_parser.asp" target="_blank">DOMParser</a> pour interpréter un fichier <i>.anl3</i> de EEP conçu en <a href="https://www.w3schools.com/xml/xml_tree.asp" target="_blank">XML</a>, pour le transformer au format <a href="https://www.w3schools.com/xml/xml_dom.asp" target="_blank">Document Object Model (DOM)</a>.<br>
Le contenu est ensuite affiché dans différents tableaux.</p>

<p lang="de">Man kann die Tabellen (bei Firefox auch mit <kbd>Strg+A</kbd>) mit Copy &amp; Paste in ein Tabellenverarbeitungsprogramm übertragen.<br>
Die Tabellen können mit Klicks in die Spaltenüberschriften sortiert werden.</p>

<p lang="en">You may load the tables (in Firefox also use <kbd>Strg+A</kbd>) with Copy &amp; Paste into a spreadsheet application.<br>
The tables can be sorted by clicking in the column-headers.</p>

<p lang="fr">Il est possible de charger les tableaux dans un tableur en utilisant copier-coller (dans Firefox également avec <kbd>Strg+A</kbd>).<br>
Les tableaux peuvent être triés en cliquant sur les entêtes des colonnes.</p>

<p lang="de">Zusätzlich wird die Bibliothek <a href='http://www.tablefilter.com/' target='_blank'>TableFilters</a> verwendet, um interaktive Funktionen zum Filtern in den Tabellen anzubieten.
Die Filter-Operatoren werden auf der Projektseite im Kapitel <a href='https://github.com/koalyptus/TableFilter/wiki/4.-Filter-operators' target='_blank'>4.-Filter-operators</a> beschrieben.</p>

<p lang="en">Additionally the <a href='http://www.tablefilter.com/' target='_blank'>TableFilters</a>-library is used to offer interactive functions for filtering in the tables.
The filter-operators are described on the project-page in chapter <a href='https://github.com/koalyptus/TableFilter/wiki/4.-Filter-operators' target='_blank'>4.-Filter-operators</a>.</p>

<p lang="fr">En plus la bibliothèque <a href='http://www.tablefilter.com/' target='_blank'>TableFilters</a> sert à offrir des fonctions interactives de filtrage à l'intérieur des tableaux.<br>
Les opérateurs de filtrage sont décrits à la page du projet dans le chapitre <a href='https://github.com/koalyptus/TableFilter/wiki/4.-Filter-operators' target='_blank'>4.-Filter-operators</a>.</p>

<p lang="de">Wenn man in einem weiteren Fenster oder einer weiteren Karteikarte des Browsers den <a href="EEP_Gleisplan.html" target="_blank">Gleisplan</a> für die gleiche EEP-Anlage-Datei öffnet, dann kann man über die Links von Gleisen, Signalen oder Kontakten den Gleisplan auf das gewählte Objekt positionieren und das Info-Popup dort öffnen:
<span class="li">wenn zusammen mit <kbd>&#x21E7; Shift</kbd>, dann wird jeweils ein neues Popup geöffnet</span>
<span class="li">wenn zusammen mit <kbd>alt</kbd>, dann wird zusätzlich der Code aus der Anlage-Datei für dieses Objekt angezeigt</span></p>

<p lang="en">By opening the <a href="EEP_Gleisplan.html" target="_blank">track map</a> of the same installation in a further window or tab of the browser, you will be able, using the links of tracks, signals or contacts, to place the track map on the selected object and to open the info-popup there:<span class="li">if together with <kbd>&#x21E7; Shift</kbd>, then you get another new popup window</span>
<span class="li">if together with <kbd>alt</kbd>, then you will get the code from the file for this object, too</span></p>

<p lang="fr">En ouvrant le <a href="EEP_Gleisplan.html" target="_blank">plan de voies</a> d'un même réseau dans une fenêtre supplémentaire ou dans un nouvel onglet du navigateur, il est possible, en utilisant les liens de voies, signaux ou contacts, de placer le plan de voies sur l'objet sélectionné et d'ouvrir un info pop-up à cet endroit:
<span class="li">en appuyant simultanément également sur <kbd>&#x21E7; Shift</kbd>, un nouveau pop-up s‘ouvrira</span>
<span class="li">en appuyant simultanément également sur <kbd>alt</kbd>, tout le code du fichier *.anl3 correspondant à cet objet s‘affichera</span></p>

</article>

<footer>
<hr>

<p lang="de"><small>(c) Frank Buchholz, 2020, mit Unterstützung von <a href="https://github.com/campersau" target="_blank">campersau</a> und <a href="https://www.eepforum.de/user/3932-messina/" target="_blank">Messina</a> (französische Übersetzung)</small></p>

<p lang="en"><small>(c) Frank Buchholz, 2020, with support by <a href="https://github.com/campersau" target="_blank">campersau</a> and <a href="https://www.eepforum.de/user/3932-messina/" target="_blank">Messina</a> (French translation)</small></p>

<p lang="fr"><small>(c) Frank Buchholz, 2020, avec le soutien de <a href="https://github.com/campersau" target="_blank">campersau</a> et <a href="https://www.eepforum.de/user/3932-messina/" target="_blank">Messina</a> (traduction en français)</small></p>

</footer>

</section>  <!-- fileselector -->

<section id='container' class='hidden'> <!-- The container shows the result -->

<h3 id='filename'></h3>

<div class='group'>
<!-- Auswahl der anzuzeigenden Objekte. class=hidden wird für diese Objekte enfernt wenn eine Checkbox aktiv ist -->
<fieldset class='fieldset'>
	<div class="item"><label><input type='checkbox' name='Intro' 		checked autocomplete='off' onchange="toggleElements('.Intro', this.checked)"><a href='#divIntro'><span lang="de">Übersicht</span><span lang="en">Overview</span><span lang="fr">Présentation</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='Weiche' 		checked autocomplete='off' onchange="toggleElements('.Weiche', this.checked)"><a href='#divWeiche'><span lang="de">Weichen</span><span lang="en">Switches</span><span lang="fr">Aguillages</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='Signal' 		checked autocomplete='off' onchange="toggleElements('.Signal', this.checked)"><a href='#divSignal'><span lang="de">Signale</span><span lang="en">Signals</span><span lang="fr">Signaux</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='Kontakt' 		checked autocomplete='off' onchange="toggleElements('.Kontakt', this.checked)"><a href='#divKontakt'><span lang="de">Kontakte</span><span lang="en">Contacts</span><span lang="fr">Contacts</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='virtualConnections' 	checked autocomplete='off' onchange="toggleElements('.virtualConnections', this.checked)"><a href='#divvirtualConnections'><span lang="de">virtuelle Verbindungen</span><span lang="en">Virtual connections</span><span lang="fr">Connexions virtuelles</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='Zugverband' 	checked autocomplete='off' onchange="toggleElements('.Zugverband', this.checked)"><a href='#divZugverband'><span lang="de">Zugverband</span><span lang="en">Train set</span><span lang="fr">Convoi ferroviaire</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='Depot' 	checked autocomplete='off' onchange="toggleElements('.Depot', this.checked)"><a href='#divDepot'><span lang="de">Depot</span><span lang="en">Depot</span><span lang="fr">Dépôt</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='Rollmaterial'	checked autocomplete='off' onchange="toggleElements('.Rollmaterial', this.checked)"><a href='#divRollmaterial'><span lang="de">Rollmaterialien</span><span lang="en">Rolling stock</span><span lang="fr">Matériel roulant</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='Gleisstil'	checked autocomplete='off' onchange="toggleElements('.Gleisstil', this.checked)"><a href='#divGleisstil'><span lang="de">Gleisstile</span><span lang="en">Track styles</span><span lang="fr">Styles de voie</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='Gleisobjekt'	checked autocomplete='off' onchange="toggleElements('.Gleisobjekt', this.checked)"><a href='#divGleisobjekt'><span lang="de">Gleisobjekte</span><span lang="en">Track objects</span><span lang="fr">Objets de voie</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='Kamera'	checked autocomplete='off' onchange="toggleElements('.Kamera', this.checked)"><a href='#divKamera'><span lang="de">Kameras</span><span lang="en">Cameras</span><span lang="fr">Caméras</span></a></label></div>
	<div class="item"><label><input type='checkbox' name='GBS'	checked autocomplete='off' onchange="toggleElements('.GBS', this.checked)"><a href='#divGBS'><span lang="de">GBS</span><span lang="en">GBS</span><span lang="fr">GBS</span></a></label></div>
	|
	<!-- Hide filter row and filter related icons to make copy&paste to Excel easier -->
	<div class="item"><label><input type='checkbox' name='Filter'		checked autocomplete='off' onchange="toggleElements('.fltrow,.rdiv', this.checked)"><span lang="de">Filter</span><span lang="en">Filter</span><span lang="fr">Filtre</span></label></div>
</fieldset>
</div>

</section> <!-- container -->

<!-- GBS --> 
<svg id="GBSsymbols" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" > 
<!-- viewBox="0 0 1000 500" width="1000" height="500"> -->
<defs>
<style>/* <![CDATA[ */
    .tile {
      fill: rgb(216, 216, 216);
    }

    .line {
      stroke: rgb(0, 0, 0); 
	  stroke-width: 12px; 
	  stroke-linecap: round; 
	  stroke-linejoin: round;
    }

    .Track_End {
      stroke: rgb(0, 0, 0); 
	  stroke-width: 7px; 
    }
	
	.signalCode {
		white-space: pre; 
		text-anchor: middle; 
		fill: rgb(51, 51, 51); 
		font-family: Arial, sans-serif; 
		font-size: 25px;
	}
	
    .block1 { /* block 1 of a track */
      /* stroke: rgb(200, 0, 0); 		/* red */
      stroke: rgb(150, 150, 150); 
	  stroke-width: 5px; 
    }
	
    .block2 { /* block 2 of a track */
      /* stroke: rgb(230, 230, 0); 		/* yellow */
      stroke: rgb(160, 160, 160); 
	  stroke-width: 5px; 
    }
	
    .block3 { /* block 3 of a track */
      /* stroke: rgb(0, 200, 0); 		/* green */
      stroke: rgb(170, 170, 170); 
	  stroke-width: 5px; 
    }
	
    .block4 { /* block 4 of a track */
      /* stroke: rgb(0, 230, 230); 		/* blue */
      stroke: rgb(180, 180, 180); 
	  stroke-width: 5px; 
    }

	.red {
		fill: rgb(249, 0, 0);			/* red */
	}

	.green {
		fill: rgb(71, 249, 0);			/* green */ 
	}

	.grey {
		fill: rgb(180, 180, 180);		/* green */ 
	}
	
	.IDtext {
		fill: white; 
		font-size: small;
		text-anchor: middle;
		alignment-baseline: central;
	}

  /* ]]> */</style>

	<!-- leer -->
	<symbol id="Tile_0" viewBox="0 0 100 100">
			<rect class="tile" x="1" y="1" width="98" height="98" rx="5" ry="5"/>
	</symbol>

	<defs> <!-- Fahrwege -->
		<line id="Track_O"  class="line" x1="0"  y1="0" x2="42" y2="0"/>  <!-- gerade -->
		<line id="Track_SO" class="line" x1="0"  y1="0" x2="42" y2="42"/> <!-- schräg -->
		<use  id="Track_S"  href="#Track_O"  transform="rotate(90)"/>
		<use  id="Track_SW" href="#Track_SO" transform="rotate(90)"/>
		<use  id="Track_W"  href="#Track_O"  transform="rotate(180)"/>
		<use  id="Track_NW" href="#Track_SO" transform="rotate(180)"/>
		<use  id="Track_N"  href="#Track_O"  transform="rotate(270)"/>
		<use  id="Track_NO" href="#Track_SO" transform="rotate(270)"/>

		<g id="Track_End">	<!-- Endebalken -->
			<line class="line" x1="0" y1="0" x2="-22" y2="0"/>  <!-- gerade -->
			<line class="Track_End" x1="-25" y1="-20" x2="-25" y2="20"/>          <!-- Endebalken -->
		</g>
		</defs>

	<defs> <!-- Block-LEDs -->
		<line id="LED"      x1="-10" y1="0" x2="10" y2="0"/>
		<use  id="LED_O"    href="#LED"   transform="rotate(0)   translate(30 0)"/>
		<use  id="LED_SO"   href="#LED"   transform="rotate(45)  translate(45 0)"/>
		<use  id="LED_S"    href="#LED"   transform="rotate(90)  translate(30 0)"/>
		<use  id="LED_SW"   href="#LED"   transform="rotate(135) translate(45 0)"/>
		<use  id="LED_W"    href="#LED"   transform="rotate(180) translate(30 0)"/>
		<use  id="LED_NW"   href="#LED"   transform="rotate(225) translate(45 0)"/>
		<use  id="LED_N"    href="#LED"   transform="rotate(270) translate(30 0)"/>
		<use  id="LED_NO"   href="#LED"   transform="rotate(315) translate(45 0)"/>

		<line id="LED_End"  x1="-20" y1="0" x2="0" y2="0"/> <!-- Led bei Endebalken --> 
	</defs>

	<!-- gerade Gleise -->
	<symbol id="Tile_1" viewBox="-50 -50 100 100">
			<title>Tile 1</title>
			<use href="#Track_W"/>
			<use href="#Track_O"/>
			<use href="#LED_W"      class="block1"/>
			<use href="#LED_O"      class="block2"/>
	</symbol>
	<symbol id="Tile_3" viewBox="-50 -50 100 100">
			<title>Tile 3</title>
			<use href="#Track_SW"/>
			<use href="#Track_NO"/>
			<use href="#LED_SW"     class="block1"/>
			<use href="#LED"        class="block2" transform="rotate(-45)"/>
			<use href="#LED_NO"     class="block3"/>
	</symbol>
	<symbol id="Tile_4" viewBox="-50 -50 100 100">
			<title>Tile 4</title>
			<use href="#Track_NW"/>
			<use href="#Track_SO"/>
			<use href="#LED_NW"     class="block1"/>
			<use href="#LED"        class="block2" transform="rotate(45)"/>
			<use href="#LED_SO"     class="block3"/>
	</symbol>
	<symbol id="Tile_45" viewBox="-50 -50 100 100">
			<title>Tile 45</title>
			<use href="#Track_S"/>
			<use href="#Track_N"/>
			<use href="#LED_S"      class="block1"/>
			<use href="#LED_N"      class="block2"/>
	</symbol>
	
	<!-- gebogene Gleise -->
	<symbol id="Tile_6" viewBox="-50 -50 100 100">
			<title>Tile 6</title>
			<use href="#Track_SW"/>
			<use href="#Track_O"/>
			<use href="#LED_SW"      class="block1"/>
			<use href="#LED_O"      class="block2"/>
	</symbol>
	<symbol id="Tile_9" viewBox="-50 -50 100 100">
			<title>Tile 9</title>
			<use href="#Track_W"/>
			<use href="#Track_SO"/>
			<use href="#LED_W"      class="block1"/>
			<use href="#LED_SO"      class="block2"/>
	</symbol>
	<symbol id="Tile_8" viewBox="-50 -50 100 100">
			<title>Tile 8</title>
			<use href="#Track_O"/>
			<use href="#Track_NW"/>
			<use href="#LED_O"      class="block1"/>
			<use href="#LED_NW"      class="block2"/>
	</symbol>
	<symbol id="Tile_7" viewBox="-50 -50 100 100">
			<title>Tile 7</title>
			<use href="#Track_W"/>
			<use href="#Track_NO"/>
			<use href="#LED_W"      class="block1"/>
			<use href="#LED_NO"      class="block2"/>
	</symbol>
	
	<symbol id="Tile_47" viewBox="-50 -50 100 100">
			<title>Tile 47</title>
			<use href="#Track_S"/>
			<use href="#Track_NO"/>
			<use href="#LED_S"      class="block1"/>
			<use href="#LED_NO"      class="block2"/>
	</symbol>
	<symbol id="Tile_46" viewBox="-50 -50 100 100">
			<title>Tile 46</title>
			<use href="#Track_S"/>
			<use href="#Track_NW"/>
			<use href="#LED_S"      class="block1"/>
			<use href="#LED_NW"      class="block2"/>
	</symbol>
	<symbol id="Tile_49" viewBox="-50 -50 100 100">
			<title>Tile 49</title>
			<use href="#Track_SO"/>
			<use href="#Track_N"/>
			<use href="#LED_SO"      class="block1"/>
			<use href="#LED_N"      class="block2"/>
	</symbol>
	<symbol id="Tile_48" viewBox="-50 -50 100 100">
			<title>Tile 48</title>
			<use href="#Track_SW"/>
			<use href="#Track_N"/>
			<use href="#LED_SW"      class="block1"/>
			<use href="#LED_N"      class="block2"/>
	</symbol>
	
	<!-- Endgleise -->
	<symbol id="Tile_10" viewBox="-50 -50 100 100">
			<title>Tile 10</title>
			<use href="#Track_O"/>
			<use href="#Track_End"                transform="rotate(0)"/>
			<use href="#LED_O"     class="block1"/>
			<use href="#LED_End"   class="block2" transform="rotate(0)"/>
	</symbol>
	<symbol id="Tile_11" viewBox="-50 -50 100 100">
			<title>Tile 11</title>
			<use href="#Track_W"/>
			<use href="#Track_End"                transform="rotate(180)"/>
			<use href="#LED_W"     class="block1"/>
			<use href="#LED_End"   class="block2" transform="rotate(180)"/>
	</symbol>
	<symbol id="Tile_50" viewBox="-50 -50 100 100">
			<title>Tile 50</title>
			<use href="#Track_N"/>
			<use href="#Track_End"                transform="rotate(270)"/>
			<use href="#LED_N"     class="block1"/>
			<use href="#LED_End"   class="block2" transform="rotate(270)"/>
	</symbol>
	<symbol id="Tile_51" viewBox="-50 -50 100 100">
			<title>Tile 51</title>
			<use href="#Track_S"/>
			<use href="#Track_End"                transform="rotate(90)"/>
			<use href="#LED_S"     class="block1"/>
			<use href="#LED_End"   class="block2" transform="rotate(90)"/>
	</symbol>
	
	<symbol id="Tile_32" viewBox="-50 -50 100 100">
			<title>Tile 32</title>
			<use href="#Track_SW"/>
			<use href="#Track_End"                transform="rotate(135)"/>
			<use href="#LED_SW"    class="block1"/>
			<use href="#LED_End"   class="block2" transform="rotate(135)"/>
	</symbol>
	<symbol id="Tile_33" viewBox="-50 -50 100 100">
			<title>Tile 33</title>
			<use href="#Track_SO"/>
			<use href="#Track_End"                transform="rotate(45)"/>
			<use href="#LED_SO"    class="block1"/>
			<use href="#LED_End"   class="block2" transform="rotate(45)"/>
	</symbol>
	<symbol id="Tile_34" viewBox="-50 -50 100 100">
			<title>Tile 34</title>
			<use href="#Track_NO"/>
			<use href="#Track_End"                transform="rotate(315)"/>
			<use href="#LED_NO"    class="block1"/>
			<use href="#LED_End"   class="block2" transform="rotate(315)"/>
	</symbol>
	<symbol id="Tile_35" viewBox="-50 -50 100 100">
			<title>Tile 35</title>
			<use href="#Track_NW"/>
			<use href="#Track_End"                transform="rotate(225)"/>
			<use href="#LED_NW"    class="block1"/>
			<use href="#LED_End"   class="block2" transform="rotate(225)"/>
	</symbol>
	
	<!-- Bahnsteig -->
	<symbol id="Tile_2" viewBox="-50 -50 100 100">
			<title>Tile 2 - Bahnsteig</title>
			<use href="#Track_W"/>
			<use href="#Track_O"/>
			<rect class="tile" x="-45" y="-30" width="90" height="20" style="fill: rgb(161, 158, 158);"/>
			<rect class="tile" x="-45" y="10"  width="90" height="20" style="fill: rgb(161, 158, 158);"/>
			<use href="#LED_W"      class="block1"/>
			<use href="#LED_O"      class="block2"/>
	</symbol>
	
	<!-- Kreuzung -->
	<symbol id="Tile_5" viewBox="-50 -50 100 100">
			<title>Tile 5 - Kreuzung</title>
			<use href="#Track_NW"/>
			<use href="#Track_SW"/>
			<use href="#Track_SO"/>
			<use href="#Track_NO"/>
			<use href="#LED_SW"      class="block1"/>
			<use href="#LED_NW"      class="block2"/>
			<use href="#LED_NO"      class="block3"/>
			<use href="#LED_SO"      class="block4"/>
	</symbol>
	
	<!-- Weichen -->
	<symbol id="Tile_13" viewBox="-50 -50 100 100">
			<title>Tile 13</title>
			<use href="#Track_W"/>
			<use href="#Track_O"/>
			<use href="#Track_NO"/>
			<use href="#LED_W"      class="block1"/>
			<use href="#LED_O"      class="block2"/>
			<use href="#LED_NO"     class="block3"/>
	</symbol>
	<symbol id="Tile_14" viewBox="-50 -50 100 100">
			<title>Tile 14</title>
			<use href="#Track_O"/>
			<use href="#Track_W"/>
			<use href="#Track_NW"/>
			<use href="#LED_O"      class="block1"/>
			<use href="#LED_W"      class="block2"/>
			<use href="#LED_NW"     class="block3"/>
	</symbol>
	<symbol id="Tile_15" viewBox="-50 -50 100 100">
			<title>Tile 15</title>
			<use href="#Track_W"/>
			<use href="#Track_O"/>
			<use href="#Track_SO"/>
			<use href="#LED_W"      class="block1"/>
			<use href="#LED_O"      class="block2"/>
			<use href="#LED_SO"     class="block3"/>
	</symbol>
	<symbol id="Tile_12" viewBox="-50 -50 100 100">
			<title>Tile 12</title>
			<use href="#Track_O"/>
			<use href="#Track_W"/>
			<use href="#Track_SW"/>
			<use href="#LED_O"      class="block1"/>
			<use href="#LED_W"      class="block2"/>
			<use href="#LED_SW"     class="block3"/>
	</symbol>
	
	<symbol id="Tile_19" viewBox="-50 -50 100 100">
			<title>Tile 19</title>
			<use href="#Track_SW"/>
			<use href="#Track_NO"/>
			<use href="#Track_O"/>
			<use href="#LED_SW"     class="block1"/>
			<use href="#LED_NO"     class="block2"/>
			<use href="#LED_O"      class="block3"/>
	</symbol>
	<symbol id="Tile_17" viewBox="-50 -50 100 100">
			<title>Tile 17</title>
			<use href="#Track_SO"/>
			<use href="#Track_NW"/>
			<use href="#Track_W"/>
			<use href="#LED_SO"     class="block1"/>
			<use href="#LED_NW"     class="block2"/>
			<use href="#LED_W"      class="block3"/>
	</symbol>
	<symbol id="Tile_18" viewBox="-50 -50 100 100">
			<title>Tile 18</title>
			<use href="#Track_NO"/>
			<use href="#Track_SW"/>
			<use href="#Track_W"/>
			<use href="#LED_NO"     class="block1"/>
			<use href="#LED_SW"     class="block2"/>
			<use href="#LED_W"      class="block3"/>
	</symbol>
	<symbol id="Tile_16" viewBox="-50 -50 100 100">
			<title>Tile 16</title>
			<use href="#Track_NW"/>
			<use href="#Track_SO"/>
			<use href="#Track_O"/>
			<use href="#LED_NW"     class="block1"/>
			<use href="#LED_SO"     class="block2"/>
			<use href="#LED_O"      class="block3"/>
	</symbol>
	
	<symbol id="Tile_40" viewBox="-50 -50 100 100">
			<title>Tile 40</title>
			<use href="#Track_NO"/>
			<use href="#Track_SW"/>
			<use href="#Track_S"/>
			<use href="#LED_NO"     class="block1"/>
			<use href="#LED_SW"     class="block2"/>
			<use href="#LED_S"      class="block3"/>
	</symbol>
	<symbol id="Tile_43" viewBox="-50 -50 100 100">
			<title>Tile 43</title>
			<use href="#Track_NW"/>
			<use href="#Track_SO"/>
			<use href="#Track_S"/>
			<use href="#LED_NW"     class="block1"/>
			<use href="#LED_SO"     class="block2"/>
			<use href="#LED_S"      class="block3"/>
	</symbol>
	<symbol id="Tile_41" viewBox="-50 -50 100 100">
			<title>Tile 41</title>
			<use href="#Track_SW"/>
			<use href="#Track_NO"/>
			<use href="#Track_N"/>
			<use href="#LED_SW"     class="block1"/>
			<use href="#LED_NO"     class="block2"/>
			<use href="#LED_N"      class="block3"/>
	</symbol>
	<symbol id="Tile_42" viewBox="-50 -50 100 100">
			<title>Tile 42</title>
			<use href="#Track_SO"/>
			<use href="#Track_NW"/>
			<use href="#Track_N"/>
			<use href="#LED_SO"     class="block1"/>
			<use href="#LED_NW"     class="block2"/>
			<use href="#LED_N"      class="block3"/>
	</symbol>
	
	<symbol id="Tile_52" viewBox="-50 -50 100 100">
			<title>Tile 52</title>
			<use href="#Track_N"/>
			<use href="#Track_S"/>
			<use href="#Track_SW"/>
			<use href="#LED_N"      class="block1"/>
			<use href="#LED_S"      class="block2"/>
			<use href="#LED_SW"     class="block3"/>
	</symbol>
	<symbol id="Tile_53" viewBox="-50 -50 100 100">
			<title>Tile 53</title>
			<use href="#Track_N"/>
			<use href="#Track_S"/>
			<use href="#Track_SO"/>
			<use href="#LED_N"      class="block1"/>
			<use href="#LED_S"      class="block2"/>
			<use href="#LED_SO"     class="block3"/>
	</symbol>
	<symbol id="Tile_54" viewBox="-50 -50 100 100">
			<title>Tile 54</title>
			<use href="#Track_S"/>
			<use href="#Track_N"/>
			<use href="#Track_NW"/>
			<use href="#LED_S"      class="block1"/>
			<use href="#LED_N"      class="block2"/>
			<use href="#LED_NW"     class="block3"/>
	</symbol>
	<symbol id="Tile_55" viewBox="-50 -50 100 100">
			<title>Tile 55</title>
			<use href="#Track_S"/>
			<use href="#Track_N"/>
			<use href="#Track_NO"/>
			<use href="#LED_S"      class="block1"/>
			<use href="#LED_N"      class="block2"/>
			<use href="#LED_NO"     class="block3"/>
	</symbol>
	
	<symbol id="Tile_21" viewBox="-50 -50 100 100">
			<title>Tile 21</title>
			<use href="#Track_W"/>
			<use href="#Track_NO"/>
			<use href="#Track_SO"/>
			<use href="#LED_W"      class="block1"/>
			<use href="#LED_NO"     class="block2"/>
			<use href="#LED_SO"     class="block3"/>
	</symbol>
	<symbol id="Tile_20" viewBox="-50 -50 100 100">
			<title>Tile 20</title>
			<use href="#Track_O"/>
			<use href="#Track_NW"/>
			<use href="#Track_SW"/>
			<use href="#LED_O"      class="block1"/>
			<use href="#LED_NW"     class="block""/>
			<use href="#LED_SW"     class="block§"/>
	</symbol>
	
	<symbol id="Tile_22" viewBox="-50 -50 100 100">
			<title>Tile 22</title>
			<use href="#Track_W"/>
			<use href="#Track_O"/>
			<use href="#Track_NO"/>
			<use href="#Track_SO"/>
			<use href="#LED_W"      class="block1"/>
			<use href="#LED_O"      class="block2"/>
			<use href="#LED_NO"     class="block3"/>
			<use href="#LED_SO"     class="block4"/>
	</symbol>
	<symbol id="Tile_23" viewBox="-50 -50 100 100">
			<title>Tile 23</title>
			<use href="#Track_O"/>
			<use href="#Track_W"/>
			<use href="#Track_NW"/>
			<use href="#Track_SW"/>
			<use href="#LED_O"      class="block1"/>
			<use href="#LED_W"      class="block2"/>
			<use href="#LED_NW"     class="block3"/>
			<use href="#LED_SW"     class="block4"/>
	</symbol>
	
	<symbol id="Tile_24" viewBox="-50 -50 100 100">
			<title>Tile 24</title>
			<use href="#Track_SW"/>
			<use href="#Track_W"/>
			<use href="#Track_NO"/>
			<use href="#Track_O"/>
			<use href="#LED_SW"     class="block1"/>
			<use href="#LED_W"      class="block2"/>
			<use href="#LED_NO"     class="block3"/>
			<use href="#LED_O"      class="block4"/>
	</symbol>
	<symbol id="Tile_25" viewBox="-50 -50 100 100">
			<title>Tile 25</title>
			<use href="#Track_W"/>
			<use href="#Track_NW"/>
			<use href="#Track_O"/>
			<use href="#Track_SO"/>
			<use href="#LED_W"      class="block1"/>
			<use href="#LED_NW"     class="block2"/>
			<use href="#LED_O"      class="block3"/>
			<use href="#LED_SO"     class="block4"/>
	</symbol>
	<symbol id="Tile_56" viewBox="-50 -50 100 100">
			<title>Tile 56</title>
			<use href="#Track_NW"/>
			<use href="#Track_N"/>
			<use href="#Track_SO"/>
			<use href="#Track_S"/>
			<use href="#LED_NW"     class="block1"/>
			<use href="#LED_N"      class="block2"/>
			<use href="#LED_SO"     class="block3"/>
			<use href="#LED_S"      class="block4"/>
	</symbol>
	<symbol id="Tile_57" viewBox="-50 -50 100 100">
			<title>Tile 57</title>
			<use href="#Track_N"/>
			<use href="#Track_NO"/>
			<use href="#Track_S"/>
			<use href="#Track_SW"/>
			<use href="#LED_N"      class="block1"/>
			<use href="#LED_NO"     class="block2"/>
			<use href="#LED_S"      class="block3"/>
			<use href="#LED_SW"     class="block4"/>
	</symbol>
	
	<!-- Signale - Overlay zu Gleis oder Weiche, Postion Links, Mitte, Rechts -->
	<symbol id="Signal_Light" viewBox="-12 -19 24 38">
			<rect x="-12" y="-19" width="24" height="38" style="fill: rgb(133, 130, 130);"/>
			<circle class="red"   cx="0" cy="-12" r="6"/>	<!-- red -->
			<circle class="green" cx="0" cy="2"  r="6">	<!-- green --> 
	</symbol> 
	<symbol id="Tile_26" viewBox="0 0 100 100">
			<title>Signal 26</title>
			<use href="#Signal_Light" x="38" y="3" width="24" height="38"/>
	</symbol>
	<symbol id="Tile_27" viewBox="0 0 100 100">
			<title>Signal 27</title>
			<use href="#Signal_Light" x="38" y="59" width="24" height="38"/>
 	</symbol>
	<symbol id="Tile_28" viewBox="0 0 100 100">
			<title>Signal 28</title>
			<rect class="tile" x="38" y="3" width="24" height="38" style="fill: rgb(133, 130, 130);"/>
			<text x="50" y="28" class="signalCode">S</text>
	</symbol>
	<symbol id="Tile_29" viewBox="0 0 100 100">
			<title>Signal 29</title>
			<rect class="tile" x="38" y="59" width="24" height="38" style="fill: rgb(133, 130, 130);"/>
			<text x="50" y="84" class="signalCode">S</text>
	</symbol>
	<symbol id="Tile_30" viewBox="0 0 100 100">
			<title>Signal 30</title>
			<rect class="tile" x="38" y="3" width="24" height="38" style="fill: rgb(133, 130, 130);"/>
			<text x="50" y="28" class="signalCode">Z</text>
	</symbol>
	<symbol id="Tile_31" viewBox="0 0 100 100">
			<title>Signal 31</title>
			<rect class="tile" x="38" y="59" width="24" height="38" style="fill: rgb(133, 130, 130);"/>
			<text x="50" y="84" class="signalCode">Z</text>
	</symbol>
	
	<!-- Sonstiges -->
	<symbol id="Tile_36" viewBox="0 0 100 100">
			<title>Tile 36 - Camera</title>
			<rect x="30" y="15" height="20" width="40" rx="5" ry="5" style="fill: rgb(0, 0, 0);"/> <!-- top -->
			<rect x="10" y="30" height="50" width="80" rx="5" ry="5" style="fill: rgb(0, 0, 0);"/> <!-- body -->
			<rect x="5" y="83"  width="90" height="15" style="fill: rgb(161, 158, 158);"/> <!-- base -->
			<circle cx="50" cy="50" r="18" fill="#ffffff"/>  <!-- lens -->
			<circle cx="50" cy="50" r="13" fill="#000000"/>  <!-- lens -->
			<circle cx="80" cy="40" r="5" fill="#ffffff"/>   <!-- flash -->
	</symbol>
	<symbol id="Tile_37" viewBox="0 0 100 100">
			<title>Tile 37 - Main switch </title>
			<rect x="5" y="44" width="90" height="12" style="fill: rgb(133, 130, 130);"/>
			<rect x="15" y="5" width="70" height="38" style="fill: rgb(232, 230, 230);"/>
			<text x="50" y="35" style="white-space: pre; text-anchor: middle; fill: rgb(0, 154, 40); font-family: Arial, sans-serif; font-size: 32px;">Ein</text>
			<rect x="15" y="57" width="70" height="38" style="fill: rgb(232, 230, 230);"/>
			<text x="50" y="85" style="white-space: pre; text-anchor: middle; fill: rgb(154, 0, 0); font-family: Arial, sans-serif; font-size: 32px;">Aus</text>
	</symbol>
	<symbol id="Tile_38" viewBox="0 0 100 100">
			<title>Tile 38 - Reset</title>
			<rect x="5" y="44" width="90" height="12" style="fill: rgb(133, 130, 130);"/>
			<rect x="5" y="57" width="90" height="38" style="fill: rgb(232, 230, 230);"/>
			<text x="50" y="85" style="white-space: pre; text-anchor: middle; fill: rgb(154, 0, 0); font-family: Arial, sans-serif; font-size: 32px;">Reset</text>
	</symbol>
	<symbol id="Tile_39" viewBox="0 0 100 100">
			<title>Tile 39 - Status</title>
			<rect x="5" y="44" width="90" height="12" style="fill: rgb(133, 130, 130);"/>
			<rect x="5" y="57" width="90" height="38" style="fill: rgb(232, 230, 230);"/>
			<text x="50" y="85" style="white-space: pre; text-anchor: middle; fill: rgb(154, 154, 154); font-family: Arial, sans-serif; font-size: 32px;">Status</text>
	</symbol>
	<symbol id="Tile_44" viewBox="0 0 100 100">
			<title>Tile 44 - Info</title>
			<rect x="15" y="15" width="30" height="70" style="fill: rgb(232, 230, 230);" rx="5" ry="5"/>
			<rect x="55" y="15" width="30" height="70" style="fill: rgb(232, 230, 230);" rx="5" ry="5"/>
	</symbol>
</defs>
</svg>

<script type="text/javascript"> // Broadcast Channel
"use strict";
// https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API

// Initialization: Connection to a broadcast channel
const EEPchannel = new BroadcastChannel('EEP');

// Example of a simple event handler that only
// logs the event to the console
EEPchannel.onmessage = function(ev) {
	console.log(ev);
}

function postGleisMessage(GleissystemID, GleisID) {					// Gleis
	EEPchannel.postMessage({
		command:		"showTrack",
		GleissystemID: 	GleissystemID,
		GleisID: 		GleisID,
		shiftDown:		global.shiftDown,
		strgDown:		global.strgDown,
		altDown:		global.altDown,
	});
}

function postIDMessage(ID, GleissystemID, GleisID) {				// Signal oder Weiche
	EEPchannel.postMessage({
		command:		"showID",
		ID: 			ID,
		GleissystemID: 	GleissystemID,
		GleisID: 		GleisID,
		shiftDown:		global.shiftDown,
		strgDown:		global.strgDown,
		altDown:		global.altDown,
	});
}

function postKontaktMessage(KontaktID, GleissystemID, GleisID) {	// Kontakt
	EEPchannel.postMessage({
		command:		"showContact",
		KontaktID: 		KontaktID,
		GleissystemID: 	GleissystemID,
		GleisID: 		GleisID,
		shiftDown:		global.shiftDown,
		strgDown:		global.strgDown,
		altDown:		global.altDown,
	});
}

function postKameraMessage(KameraID) {	// Kamera
	EEPchannel.postMessage({
		command:		"showCamera",
		KameraID: 		KameraID,
		shiftDown:		global.shiftDown,
		strgDown:		global.strgDown,
		altDown:		global.altDown,
	});
}

function postGBSMessage(GBSID) {	// GBS
	EEPchannel.postMessage({
		command:		"showGBS",
		GBSID: 			GBSID,
		shiftDown:		global.shiftDown,
		strgDown:		global.strgDown,
		altDown:		global.altDown,
	});
}

const global = {};
global.shiftDown 	= false;
global.strgDown 	= false;
global.altDown 		= false;
document.addEventListener('keydown', function(event){
    if			(event.keyCode === 16 || event.charCode === 16){
        global.shiftDown = true;
    } else if	(event.keyCode === 17 || event.charCode === 17){
        global.strgDown = true;
    } else if	(event.keyCode === 18 || event.charCode === 18){
        global.altDown = true;
    }
});
document.addEventListener('keyup', function(event){
    if			(event.keyCode === 16 || event.charCode === 16){
        global.shiftDown = false;
    } else if	(event.keyCode === 17 || event.charCode === 17){
        global.strgDown = false;
    } else if	(event.keyCode === 18 || event.charCode === 18){
        global.altDown = false;
    }
});

// Disconnect the channel
//EEPchannel.close();

</script>

</body>
</html>